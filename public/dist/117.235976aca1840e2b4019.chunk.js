webpackJsonp([117,213],{1620:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=a(101),i=n(o),r=a(239),s=n(r),l=a(601),c=n(l);e.default={name:"buy-promotion",components:{orderTable:c.default},data:function(){var t=this;return{dateE:"",queryArray:{beginDate:"",endDate:"",code:"",title:"",status:"",page:this.current,code79:"",barCode:"",itemName:""},cityList:[{label:"全部",value:""},{label:"未生效",value:"1"},{label:"生效中",value:"2"},{label:"已失效",value:"3"},{label:"已下架",value:"4"}],tableRef:"",loading:!0,columnsList:[{type:"selection",width:60,align:"center",fixed:"left"},{title:"序号",type:"index",width:80,align:"center"},{title:"促销编码",key:"promotionCode",align:"center"},{title:"促销名称",key:"title",align:"center"},{title:"促销类型",key:"type",align:"center",render:function(t,e){return t("div","买赠")}},{title:"开始时间",key:"beginDate",width:155,align:"center",render:function(e,a){return e("div",{},t.timestampToTime(a.row.beginDate))}},{title:"结束时间",key:"endDate",width:155,align:"center",render:function(e,a){return e("div",{},t.timestampToTime(a.row.endDate))}},{title:"促销状态",key:"status",align:"center",render:function(e,a){if(a.row.status)return e("div",t.cityList[a.row.status].label)}},{title:"操作",key:"handel",width:180,align:"center",render:function(e,a){var n=[e("Button",{props:{size:"small"},style:{marginRight:"5px"},on:{click:function(){t.$router.push({path:"buyPromotion-detail",query:{id:a.row.id}})}}},"查看")],o="";return 2==a.row.status?o="下架":4==a.row.status&&(o="上架"),4!=a.row.status&&2!=a.row.status||n.unshift(e("Button",{props:{size:"small"},style:{marginRight:"5px"},on:{click:function(){2==a.row.status?t.changeType="下架":4==a.row.status&&(t.changeType="上架"),t.currentId=a.row.id,t.getStatus=a.row.status,t.MoadlShow(a.row.status)}}},o)),1==a.row.status&&n.unshift(e("Button",{props:{size:"small"},style:{marginRight:"5px"},on:{click:function(){t.$router.push({path:"buyPromotion-add",query:{id:a.row.id,editPage:t.current}})}}},"编辑"),e("Button",{props:{size:"small"},style:{marginRight:"5px"},on:{click:function(){t.changeType="删除",t.currentId=a.row.id,t.getStatus=a.row.status,t.getSelectId=[],t.getSelectId=[a.row.id],t.MoadlShow(a.row.status)}}},"删除")),e("div",n)}}],thisTableData:[],totalCount:0,current:1,changeModal:!1,changeType:"",currentId:"",getStatus:"",showClash:!1,clashList:[],isClash:!1,clashChecking:!1,createDateOptions:{disabledDate:function(e){return e&&e.valueOf()+864e5-1<new Date(t.queryArray.beginDate)}},getSelectId:[],tableShow:!0}},methods:{initNumber:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"queryArray",n=t.target.value,o=/^[A-Z|a-z|_|0-9]*$/;console.log(!o.test(n)),o.test(n)?(this[a][e]=n,setTimeout(function(e){return t.target.value=n})):(this[a][e]="",setTimeout(function(e){return t.target.value=""}))},query:function(t){var e=this;this.current=t,this.queryArray.page=t,this.$util.ajax({method:"post",url:e.$util.apiConfig.promotionManage.warProgramme.buyPromotion.listUrl,data:s.default.stringify(this.queryArray)}).then(function(t){if(e.loading=!1,200==t.data.code){if(e.getSelectId=[],e.tableShow=!1,setTimeout(function(t){e.tableShow=!0}),e.thisTableData=[],null==t.data.result.pager.records)return;var a=t.data.result.pager.records;for(var n in a)1!=a[n].status&&(a[n]._disabled=!0),e.thisTableData.push(a[n]);e.totalCount=t.data.result.pager.totalCount}else e.$Modal.error({title:"提示",content:t.data.message})}).catch(function(t){e.loading=!1,console.log("失败信息：",t)})},MoadlShow:function(t){if(4==t)return void this.checkId();this.changeModal=!0},checkId:function(){var t=this;this.$util.ajax({method:"post",url:t.$util.apiConfig.promotionManage.warProgramme.checkGoodsListNew,data:{promotionInfoDTO:{id:t.currentId}}}).then(function(e){if(200==e.data.code)t.changeModal=!0;else if(400==e.data.code){t.showClash=!0,t.clashChecking=!1,t.clashList=e.data.result;for(var a=0;a<t.clashList.length;a++)1==t.clashList[a].promotionInfoDTO.type&&(t.isClash=!0)}else t.$Modal.error({title:"提示",content:e.data.message})}).catch(function(t){console.log("失败信息：",t)})},clashIgnore:function(){this.showClash=!1,this.changeModal=!0},linkToDetail:function(t,e){var a="";"1"==t&&(a="/#/marketing/marketing-center/buy-promotion-index/buyPromotion-detail?id="+e),"2"==t&&(a="/#/marketing/marketing-center/rebate-promotion-index/rebatePromotion-detail?id="+e),"3"==t&&(a="/#/marketing/marketing-center/sale-promotion-index/salePromotion-detail?id="+e),window.open(a,"_blank")},handelStatus:function(){var t=this;if(1==t.getStatus)return void this.delData();var e="";4==t.getStatus&&(e=2),2==t.getStatus&&(e=4),this.$util.ajax({method:"post",url:t.$util.apiConfig.promotionManage.warProgramme.updatePromotionStatus,data:s.default.stringify({id:t.currentId,status:e})}).then(function(e){200==e.data.code?(t.query(t.current),t.$Modal.success({title:"提示",content:"修改成功"})):t.$Modal.error({title:"提示",content:e.data.message})}).catch(function(t){console.log("失败信息：",t)})},newPage:function(){delete window.sessionStorage.buyPromotionEditParams,this.$router.push({path:"buyPromotion-add",query:{isFromCreate:"1"}})},timestampToTime:function(t){var e=new Date(t);return e.getFullYear()+"-"+(e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"-"+(e.getDate()<10?"0"+e.getDate():e.getDate())+" "+(e.getHours()<10?"0"+e.getHours():e.getHours())+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+":"+(e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds())},createSTimeChangeHandle:function(t){this.queryArray.beginDate=t,this.queryArray.beginDate>this.queryArray.endDate&&(this.queryArray.endDate="")},createETimeChangeHandle:function(t){this.queryArray.endDate=t},delData:function(){var t=this;this.$util.ajax({method:"post",url:t.$util.apiConfig.promotionManage.warProgramme.delDataUrl,data:this.getSelectId}).then(function(e){"200"==e.data.code?(t.query(t.current),t.$Modal.success({title:"提示",content:"删除成功"})):t.$Modal.error({title:"提示",content:e.data.message})}).catch(function(t){console.log(t)})},getSelection:function(t){this.getSelectId=[];for(var e in t)this.getSelectId.push(t[e].id)},batchDel:function(){if(0==this.getSelectId.length)return void this.$Modal.error({title:"提示",content:"请先勾选数据！"});this.getStatus=1,this.changeType="删除",this.MoadlShow()},reset:function(){this.queryArray=(0,i.default)(this.queryArray,{beginDate:"",endDate:"",code:"",title:"",status:"",page:this.current,code79:"",barCode:"",itemName:""}),this.query(1)}},mounted:function(){this.query(1)},beforeRouteEnter:function(t,e,a){a(function(t){"buyPromotion-detail"==e.name&&(t.$route.query.isFromCreate&&t.reset(),t.$route.query.editPage&&t.query(t.$route.query.editPage))})},beforeRouteLeave:function(t,e,a){(this.$util.cache.fromArr.includes(t.name)&&this.$util.cache.fromArr.includes(e.name)||!this.$util.cache.toArr.includes(t.name)&&this.$util.cache.fromArr.includes(e.name))&&this.reset(),a()}}},2117:function(t,e,a){var n=a(2118);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);a(43)("471889fb",n,!1,{})},2118:function(t,e,a){e=t.exports=a(42)(!1),e.push([t.i,"\n.ListName[data-v-c8018486]{\n    text-align: right;\n    line-height: 32px;\n    color: #747474;\n    font-size: 12px;\n    margin-right:8px;\n}\n/* 冲突提示框 */\n.content-box[data-v-c8018486]{\n    max-height: 320px;\n    overflow-y: auto;\n}\n.clash-header[data-v-c8018486]{\n    font-size: 14px;\n    text-align: center;\n    font-weight: 600;\n}\n.clash-list[data-v-c8018486]{\n    margin-bottom: 15px;\n    padding-left: 30px;\n}\n.clash-active[data-v-c8018486]{\n    padding: 3px 5px;\n    background: #999999;\n    color: #FFFFFF;\n}\n.clash-item[data-v-c8018486]{\n    padding-left: 10px;\n    margin: 10px 0;\n}\n.clash-item .clash-type[data-v-c8018486]{\n    color: #FFFFFF;\n    background: red;\n    padding: 3px;\n}\n.clash-item .activeNUm[data-v-c8018486]{\n    color: royalblue;\n    cursor: pointer;\n}\n.clash-item .goods-list[data-v-c8018486]{\n    padding-top: 5px;\n}\n.clash-item .goods-list .goods-num[data-v-c8018486]{\n    color: royalblue;\n    cursor: pointer;\n}\n.submit-btn[data-v-c8018486]{\n    min-width: 60px;\n}\n",""])},2119:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{height:"auto",background:"#fff"}},[a("Row",{staticStyle:{padding:"20px","border-bottom":"1px dashed #e5e5e5"}},[a("row",{staticStyle:{"margin-bottom":"14px"}},[a("Col",{attrs:{span:"7"}},[a("Col",{staticClass:"ListName",attrs:{span:"8"}},[t._v("促销编码 :")]),t._v(" "),a("Col",{attrs:{span:"15"}},[a("Input",{staticStyle:{width:"100%"},attrs:{value:t.queryArray.promotionCode,clearable:""},on:{"on-change":function(e){return t.initNumber(e,"promotionCode","queryArray")}}})],1)],1),t._v(" "),a("Col",{attrs:{span:"7"}},[a("Col",{staticClass:"ListName",attrs:{span:"8"}},[t._v("促销名称 :")]),t._v(" "),a("Col",{attrs:{span:"15"}},[a("Input",{staticStyle:{width:"100%"},attrs:{clearable:""},model:{value:t.queryArray.title,callback:function(e){t.$set(t.queryArray,"title",e)},expression:"queryArray.title"}})],1)],1),t._v(" "),a("Col",{attrs:{span:"7"}},[a("Col",{staticClass:"ListName",attrs:{span:"8"}},[t._v("促销状态 :")]),t._v(" "),a("Col",{attrs:{span:"15"}},[a("Select",{staticStyle:{width:"100%"},attrs:{clearable:""},model:{value:t.queryArray.status,callback:function(e){t.$set(t.queryArray,"status",e)},expression:"queryArray.status"}},t._l(t.cityList,function(e){return a("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.label))])}))],1)],1)],1),t._v(" "),a("row",{staticStyle:{"margin-bottom":"14px"}},[a("Col",{attrs:{span:"7"}},[a("Col",{staticClass:"ListName",attrs:{span:"8"}},[t._v("销售编码 :")]),t._v(" "),a("Col",{attrs:{span:"15"}},[a("Input",{staticStyle:{width:"100%"},attrs:{value:t.queryArray.code79,clearable:""},on:{"on-change":function(e){return t.initNumber(e,"code79","queryArray")}}})],1)],1),t._v(" "),a("Col",{attrs:{span:"7"}},[a("Col",{staticClass:"ListName",attrs:{span:"8"}},[t._v("条形码 :")]),t._v(" "),a("Col",{attrs:{span:"15"}},[a("Input",{staticStyle:{width:"100%"},attrs:{clearable:""},on:{"on-change":function(e){return t.initNumber(e,"barCode","queryArray")}},model:{value:t.queryArray.barCode,callback:function(e){t.$set(t.queryArray,"barCode",e)},expression:"queryArray.barCode"}})],1)],1),t._v(" "),a("Col",{attrs:{span:"7"}},[a("Col",{staticClass:"ListName",attrs:{span:"8"}},[t._v("商品名称 :")]),t._v(" "),a("Col",{attrs:{span:"15"}},[a("Input",{staticStyle:{width:"100%"},attrs:{clearable:""},model:{value:t.queryArray.itemName,callback:function(e){t.$set(t.queryArray,"itemName",e)},expression:"queryArray.itemName"}})],1)],1)],1),t._v(" "),a("row",{staticStyle:{"margin-bottom":"14px"}},[a("Col",{attrs:{span:"7"}},[a("Col",{staticClass:"ListName",attrs:{span:"8"}},[t._v("开始时间 :")]),t._v(" "),a("Col",{attrs:{span:"15"}},[a("DatePicker",{staticStyle:{width:"100%"},attrs:{type:"datetime",value:t.queryArray.beginDate,placeholder:"请选择时间"},on:{"on-change":t.createSTimeChangeHandle}})],1)],1),t._v(" "),a("Col",{attrs:{span:"7"}},[a("Col",{staticClass:"ListName",attrs:{span:"8"}},[t._v("结束时间 :")]),t._v(" "),a("Col",{attrs:{span:"15"}},[a("DatePicker",{staticStyle:{width:"100%"},attrs:{type:"datetime",value:t.queryArray.endDate,options:t.createDateOptions,placeholder:"请选择时间"},on:{"on-change":t.createETimeChangeHandle}})],1)],1)],1),t._v(" "),a("row",{staticStyle:{"margin-bottom":"12px"}},[a("Col",{attrs:{span:"24"}},[a("Button",{staticStyle:{float:"right"},attrs:{type:"primary"},on:{click:function(e){t.query(1)}}},[t._v("查询")])],1)],1)],1),t._v(" "),a("row",{staticStyle:{padding:"20px"}},[a("row",{staticStyle:{"margin-bottom":"12px"}},[a("Col",{attrs:{span:"24"}},[a("Button",{staticStyle:{float:"right","margin-left":"20px"},attrs:{type:"primary"},on:{click:function(e){t.batchDel()}}},[t._v("删除")]),t._v(" "),a("Button",{staticStyle:{float:"right"},attrs:{type:"primary"},on:{click:t.newPage}},[t._v("新建")])],1)],1),t._v(" "),t.tableShow?a("order-table",{attrs:{refs:t.tableRef,columnsList:t.columnsList,thisTableData:t.thisTableData,loading:t.loading},on:{listenCheckbox:t.getSelection}}):t._e()],1),t._v(" "),a("div",{staticStyle:{padding:"20px",overflow:"hidden"}},[a("Page",{staticStyle:{float:"right"},attrs:{total:t.totalCount,"page-size":10,current:t.current,"show-total":"","show-elevator":""},on:{"on-change":t.query}})],1),t._v(" "),a("Modal",{attrs:{title:"提示"},on:{"on-ok":t.handelStatus},model:{value:t.changeModal,callback:function(e){t.changeModal=e},expression:"changeModal"}},[a("p",[t._v("您确定要"+t._s(t.changeType)+"吗？")])]),t._v(" "),a("Modal",{attrs:{width:"700","mask-closable":!1,closable:!1},model:{value:t.showClash,callback:function(e){t.showClash=e},expression:"showClash"}},[a("div",{staticClass:"clash-header",attrs:{slot:"header"},slot:"header"},[t._v("\n            以下商品在当前执行范围和执行时间段内已配置以下方案，\n            "),t.isClash?t._e():a("span",[t._v("是否叠加发布促销活动")]),t._v(" "),t.isClash?a("span",[t._v("不能发布促销活动")]):t._e()]),t._v(" "),a("Row",[a("div",{staticClass:"content-box"},t._l(t.clashList,function(e){return a("div",{staticClass:"clash-list"},[1==e.promotionInfoDTO.fromChannel?a("span",{staticClass:"clash-active"},[t._v("经销商活动")]):t._e(),t._v(" "),2==e.promotionInfoDTO.fromChannel?a("span",{staticClass:"clash-active"},[t._v("集团活动")]):t._e(),t._v(" "),a("div",{staticClass:"clash-item"},[1==e.promotionInfoDTO.type?a("span",{staticClass:"clash-type"},[t._v("买赠")]):t._e(),t._v(" "),2==e.promotionInfoDTO.type?a("span",{staticClass:"clash-type"},[t._v("返利")]):t._e(),t._v(" "),3==e.promotionInfoDTO.type?a("span",{staticClass:"clash-type"},[t._v("特价")]):t._e(),t._v(" "),a("span",[t._v(" "+t._s(e.promotionInfoDTO.title)+" ")]),t._v(" "),a("span",{staticClass:"activeNUm",on:{click:function(a){t.linkToDetail(e.promotionInfoDTO.type,e.promotionInfoDTO.id)}}},[t._v(" "+t._s(e.promotionInfoDTO.promotionCode)+" 查看详细 》")]),t._v(" "),t._l(e.giftGoodsResultList,function(n){return 1==e.promotionInfoDTO.type?a("div",{staticClass:"goods-list"},[a("span",[t._v("商品 "+t._s(n.itemName)+" "),a("span",{staticClass:"goods-num",on:{click:function(a){t.linkToDetail("1",e.promotionInfoDTO.id)}}},[t._v("（"+t._s(n.barCode)+"）")]),t._v(" 在活动中存在冲突")])]):t._e()}),t._v(" "),t._l(e.specialGoodsResultList,function(n){return 2==e.promotionInfoDTO.type?a("div",{staticClass:"goods-list"},[a("span",[t._v("商品 "+t._s(n.itemName)+" "),a("span",{staticClass:"goods-num",on:{click:function(a){t.linkToDetail("2",e.promotionInfoDTO.id)}}},[t._v("（"+t._s(n.barCode)+"）")]),t._v(" 在活动中存在冲突")])]):t._e()}),t._v(" "),t._l(e.specialGoodsResultList,function(n){return 3==e.promotionInfoDTO.type?a("div",{staticClass:"goods-list"},[a("span",[t._v("商品 "+t._s(n.itemName)+" "),a("span",{staticClass:"goods-num",on:{click:function(a){t.linkToDetail("3",e.promotionInfoDTO.id)}}},[t._v("（"+t._s(n.barCode)+"）")]),t._v(" 在活动中存在冲突")])]):t._e()})],2)])}))]),t._v(" "),a("div",{staticStyle:{"text-align":"center"},attrs:{slot:"footer"},slot:"footer"},[t.isClash?a("Button",{on:{click:function(e){t.showClash=!1}}},[t._v("确定")]):t._e(),t._v(" "),t.isClash?t._e():a("Button",{staticClass:"submit-btn",on:{click:function(e){t.showClash=!1}}},[t._v("否")]),t._v(" "),t.isClash?t._e():a("Button",{staticClass:"submit-btn",attrs:{type:"primary"},on:{click:t.clashIgnore}},[t._v("是")])],1)],1)],1)},o=[];n._withStripped=!0;var i={render:n,staticRenderFns:o};e.default=i},601:function(t,e,a){"use strict";function n(t){c||a(900)}Object.defineProperty(e,"__esModule",{value:!0});var o=a(891),i=a.n(o);for(var r in o)"default"!==r&&function(t){a.d(e,t,function(){return o[t]})}(r);var s=a(902),l=a.n(s),c=!1,u=a(13),d=n,p=u(i.a,l.a,!1,d,null,null);p.options.__file="src/views/tables/components/orderTable.vue",e.default=p.exports},738:function(t,e,a){"use strict";function n(t){c||a(2117)}Object.defineProperty(e,"__esModule",{value:!0});var o=a(1620),i=a.n(o);for(var r in o)"default"!==r&&function(t){a.d(e,t,function(){return o[t]})}(r);var s=a(2119),l=a.n(s),c=!1,u=a(13),d=n,p=u(i.a,l.a,!1,d,"data-v-c8018486",null);p.options.__file="src/views/promotion-manage/war-programme/buy-promotion/buyPromotion-list.vue",e.default=p.exports},891:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"orderTable",props:{columnsList:Array,thisTableData:Array,getHeight:Number,loading:{type:Boolean,default:!0}},data:function(){return{}},created:function(){this.init()},methods:{init:function(){var t=this;this.columnsList.forEach(function(e){"address1"==e.key&&(e.render=function(e,a){return e("Row",{props:{type:"flex",align:"middle",justify:"center"}},[e("Col",{props:{span:"22"}},a.row.name),e("Col",{props:{span:"2"}},[e("Button",{props:{type:"text",icon:"edit"},on:{click:function(e){t.$emit("showLayer","true")}}})])])})})},a:function(t){this.$emit("listenCheckbox",t)}},watch:{}}},900:function(t,e,a){var n=a(901);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);a(43)("296919d0",n,!1,{})},901:function(t,e,a){e=t.exports=a(42)(!1),e.push([t.i,"\n.show-edit-btn {\n  display: none;\n  margin-left: -10px;\n}\n.ivu-table-cell:hover .show-edit-btn {\n  display: inline-block;\n}\n",""])},902:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Table",{attrs:{height:t.getHeight,columns:t.columnsList,data:t.thisTableData,stripe:"",border:"",loading:t.loading},on:{"on-selection-change":t.a}})],1)},o=[];n._withStripped=!0;var i={render:n,staticRenderFns:o};e.default=i}});