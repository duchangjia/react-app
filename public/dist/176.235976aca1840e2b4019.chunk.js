webpackJsonp([176],{1111:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(239),o=function(e){return e&&e.__esModule?e:{default:e}}(a),s=r(898);t.default={props:{visible:{default:!1,type:Boolean},orderId:{default:"2018092000007423",type:[String,Number]},orderDetail:{default:function(){return{}},type:Object}},data:function(){return{modalVisible:!1,remark:"",signTime:"",isCreateReceipt:!1,orderItems:[],orderMain:{},submiting:!1,voucherInfo:""}},mounted:function(){this.modalVisible=this.visible},methods:{cancel:function(){this.$emit("update:visible",!1)},submit:function(){var e=this;if(""==this.signTime)return void this.$Modal.error({title:"签收信息有误",content:"签收时间不能为空"});var t={};t.orderId=this.orderId,t.storeCode=this.orderMain.storeCode,t.receiptBy=this.orderMain.receiverName,t.receiptTime=this.signTime,t.receiptNote=this.remark,t.orderReceiptProductDTOList=[],t.isCreateReceipt=this.isCreateReceipt?1:0;var r=!1,a=0;if(this.orderItems.forEach(function(e){var o=Number(e.signCar)*Number(e.packageNum)+Number(e.signEa);if(o>Number(e.outEaNum))return void(r=!0);""===e.signCar&&(e.signCar=0),""===e.signEa&&(e.signEa=0),0==e.signCar&&0==e.signEa&&a++,t.orderReceiptProductDTOList.push({originalEntryNo:e.id,code79:e.item79,transformRule:e.packageNum,carNum:e.chuKuCar,eaNum:e.chuKuEA,deliveryByEa:e.outEaNum,receiptCarNum:e.signCar,receiptEaNum:e.signEa,totalNum:o,itemType:e.itemType})}),r)return void this.$Modal.error({title:"签收数量填写错误",content:"填写的签收数量不能大于发货数"});if(a==this.orderItems.length)return void this.$Modal.error({title:"签收数量填写错误",content:"所有商品的签收数量不能全为0"});var o=1;this.$store.state.app.statusInfo.promotionMode?o=this.$store.state.app.statusInfo.promotionMode:localStorage.promotionMode&&(o=localStorage.promotionMode);var s="/trade/order/updateOrderReceiptDTOSignIn";2==o&&(s="/trade/order/updateOrderReceiptDTOSignInV2"),console.log("签收发送数据：",t),this.submiting=!0,this.$util.ajax.post(s,t).then(function(t){e.submiting=!1,t.data.success?e.$Modal.success({title:"操作成功",content:t.data.message,onOk:function(){e.$emit("successCallback"),e.cancel()}}):e.$Modal.error({title:"操作失败",content:t.data.message})}).catch(function(t){e.submiting=!1,e.$Modal.error({title:"http请求失败",content:"签收请求失败"})})},signTimeChangeHandle:function(e){this.signTime=e},formatNum:function(e){event.target.value=event.target.value.replace(/[^\d]/g,"")}},watch:{visible:function(e){var t=this;1==e?(this.voucherInfo="",this.$util.ajax.post("/trade/order/getDetail/json",o.default.stringify({orderId:this.orderId})).then(function(r){if(console.log("订单详情数据：",r),200==r.status){t.modalVisible=e;var a=(new Date).getTime();t.signTime=(0,s.timestampToDay)(a,"yyyy-MM-dd hh:mm:ss"),t.orderMain=r.data.result.tradeOrder.orderMain,t.orderItems=r.data.result.tradeOrder.orderItems;for(var o=0;o<t.orderItems.length;o++)t.orderItems[o].itemName+=" * "+t.orderItems[o].packageNum,t.orderItems[o].outEaNum=t.orderItems[o].outEaNum?Number(t.orderItems[o].outEaNum):0,0!=t.orderItems[o].outEaNum?(t.orderItems[o].chuKuCar=Math.floor(t.orderItems[o].outEaNum/t.orderItems[o].packageNum),t.orderItems[o].chuKuEA=t.orderItems[o].outEaNum%t.orderItems[o].packageNum,t.orderItems[o].signCar=t.orderItems[o].chuKuCar,t.orderItems[o].signEa=t.orderItems[o].chuKuEA):(t.orderItems[o].chuKuEA=0,t.orderItems[o].chuKuCar=0,t.orderItems[o].signEaNum=0,t.orderItems[o].signCar=0,t.orderItems[o].signEa=0);var i=1;if(t.$store.state.app.statusInfo.promotionMode?i=t.$store.state.app.statusInfo.promotionMode:localStorage.promotionMode&&(i=localStorage.promotionMode),"O2O"==t.orderMain.tradeSourcePlatform&&2==i){var n={};n.orderMain={orderCode:t.orderMain.sourceOrderNo,orderPlatform:t.orderMain.tradeSourcePlatform,salesmanCode:t.orderMain.createPerson,storeCode:t.orderMain.storeCode,totalAmount:t.orderMain.itemToalAmount},n.orderItemList=[],t.orderItems.forEach(function(e){n.orderItemList.push({code79:e.code79,itemCnt:e.auditEaNum,itemUnit:0})}),t.$util.ajax.post("/trade/order/previewRealTimeIssueVoucher",n).then(function(e){if(200==e.data.code){var r=e.data.result.result.rows;if(r instanceof Array&&r.length>0){var a="";r.forEach(function(e){a+="【"+e.voucherTypeName+"】,【"+e.voucherPrice+"元】|"}),a=a.replace(/\|*$/g,""),t.voucherInfo="签收后，将发放如下代金券："+a+"（最终发券以实际发放为准）"}}})}}else t.$Modal.error({title:"HTTP请求错误",content:r.statusText})}).catch(function(e){console.log(e),t.$Modal.error({title:"HTTP请求错误",content:"HTTP请求错误"})})):this.modalVisible=e}}}},1427:function(e,t,r){var a=r(1428);"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);r(43)("eb351b5c",a,!1,{})},1428:function(e,t,r){t=e.exports=r(42)(!1),t.push([e.i,"\n.row .grid[data-v-47bc7625]{\r\n    height: 50px;\r\n    border-top: 1px #e5e5e5 solid;\r\n    border-left: 1px #e5e5e5 solid;\r\n    line-height: 50px;\r\n    padding:0 10px;\n}\n.row .grid[data-v-47bc7625]:last-child{\r\n    border-right: 1px #e5e5e5 solid;\n}\n.row .grid[data-v-47bc7625]:nth-child(odd){\r\n    background-color: #eee;\r\n    text-align: right;\n}\n.last-row .grid[data-v-47bc7625]{\r\n    border-bottom: 1px #e5e5e5 solid;\n}\n.goods-table[data-v-47bc7625],\r\n.goods-table th[data-v-47bc7625], \r\n.goods-table td[data-v-47bc7625] {\r\n    border: 1px #e5e5e5 solid;\r\n    padding: 5px;\n}\n.goods-table td + td[data-v-47bc7625]{\r\n    text-align: center;\n}\n.goods-table th[data-v-47bc7625] {\r\n    background-color: #eee;\n}\n.itemContenter[data-v-47bc7625]{\r\n    overflow: hidden;\r\n    white-space: nowrap;\r\n    text-overflow: ellipsis;\r\n    width: 155px;\n}\n.goods-quantity-input *[data-v-47bc7625]{\r\n    display: inline-block;\r\n    width: 50px;\n}\r\n\r\n\r\n\r\n",""])},1429:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("modal",{attrs:{width:"600",title:"订单签收"},on:{"on-cancel":e.cancel},model:{value:e.modalVisible,callback:function(t){e.modalVisible=t},expression:"modalVisible"}},[r("div",[r("Row",{staticClass:"row"},[r("Col",{staticClass:"grid",attrs:{span:"4"}},[r("span",[e._v("订单单号")])]),e._v(" "),r("Col",{staticClass:"grid",attrs:{span:"8"}},[r("span",[e._v(e._s(e.orderMain.orderNo))])]),e._v(" "),r("Col",{staticClass:"grid",attrs:{span:"4"}},[r("span",[e._v("门店名称")])]),e._v(" "),r("Col",{staticClass:"grid",attrs:{span:"8"}},[r("p",[e._v(e._s(e.orderMain.storeName))])])],1),e._v(" "),r("Row",{staticClass:"row"},[r("Col",{staticClass:"grid",attrs:{span:"4"}},[r("span",[e._v("所在区域")])]),e._v(" "),r("Col",{staticClass:"grid",attrs:{span:"8"}},[r("p",{staticClass:"itemContenter"},[e._v(e._s(e.orderMain.provinceName)+e._s(e.orderMain.cityName)+e._s(e.orderMain.areaName))])]),e._v(" "),r("Col",{staticClass:"grid",attrs:{span:"4"}},[r("span",[e._v("详细地址")])]),e._v(" "),r("Col",{staticClass:"grid",attrs:{span:"8"}},[r("p",{staticClass:"itemContenter"},[e._v(e._s(e.orderMain.detailAddress))])])],1),e._v(" "),r("Row",{staticClass:"row"},[r("Col",{staticClass:"grid",attrs:{span:"4"}},[r("span",[e._v("联系电话")])]),e._v(" "),r("Col",{staticClass:"grid",attrs:{span:"8"}},[r("span",[e._v(e._s(e.orderMain.receiverMobile))])]),e._v(" "),r("Col",{staticClass:"grid",attrs:{span:"4"}},[r("span",[e._v("签收人")])]),e._v(" "),r("Col",{staticClass:"grid",attrs:{span:"8"}},[r("Input",{attrs:{type:"text",placeholder:"请输入签收人",maxlength:100},model:{value:e.orderMain.receiverName,callback:function(t){e.$set(e.orderMain,"receiverName","string"==typeof t?t.trim():t)},expression:"orderMain.receiverName"}})],1)],1),e._v(" "),r("Row",{staticClass:"row"},[r("Col",{staticClass:"grid",attrs:{span:"4"}},[r("span",[e._v("签收时间")])]),e._v(" "),r("Col",{staticClass:"grid",attrs:{span:"8"}},[r("date-picker",{attrs:{value:e.signTime,format:"yyyy-MM-dd HH:mm:ss",type:"datetime",placeholder:"请选择时间"},on:{"on-change":e.signTimeChangeHandle}})],1),e._v(" "),r("Col",{staticClass:"grid",attrs:{span:"4"}},[r("span",[e._v("是现金单")])]),e._v(" "),r("Col",{staticClass:"grid",attrs:{span:"8"}},[r("Checkbox",{model:{value:e.isCreateReceipt,callback:function(t){e.isCreateReceipt=t},expression:"isCreateReceipt"}})],1)],1),e._v(" "),r("Row",{staticClass:"row last-row"},[r("Col",{staticClass:"grid",attrs:{span:"4"}},[r("span",[e._v("签收备注")])]),e._v(" "),r("Col",{staticClass:"grid",attrs:{span:"20"}},[r("Input",{attrs:{type:"text",placeholder:"请输入签收备注",maxlength:200},model:{value:e.remark,callback:function(t){e.remark="string"==typeof t?t.trim():t},expression:"remark"}})],1)],1),e._v(" "),r("br"),e._v(" "),r("Row",[e._v("\n            商品明细\n        ")]),e._v(" "),r("br"),e._v(" "),r("table",{staticClass:"goods-table",staticStyle:{width:"100%","border-collapse":"collapse"}},[r("thead",[r("tr",[r("th",{staticStyle:{width:"360px"}},[e._v("\n                        商品名称\n                    ")]),e._v(" "),r("th",[r("div",[e._v("发货数")]),e._v(" "),r("div",[e._v("CAR/EA")])]),e._v(" "),r("th",[r("div",[e._v("签收数")]),e._v(" "),r("div",[e._v("CAR/EA")])])])]),e._v(" "),r("tbody",e._l(e.orderItems,function(t){return 0!=t.outEaNum?r("tr",{key:t.id},[r("td",[e._v(e._s(t.itemName))]),e._v(" "),r("td",[e._v(e._s(t.chuKuCar||0)+"/"+e._s(t.chuKuEA||0))]),e._v(" "),r("td",{staticClass:"goods-quantity-input"},[r("input",{directives:[{name:"model",rawName:"v-model",value:t.signCar,expression:"item.signCar"}],staticClass:"ivu-input",attrs:{type:"text",placeholder:"CAR"},domProps:{value:t.signCar},on:{input:[function(r){r.target.composing||e.$set(t,"signCar",r.target.value)},e.formatNum]}}),e._v(" "),r("input",{directives:[{name:"model",rawName:"v-model",value:t.signEa,expression:"item.signEa"}],staticClass:"ivu-input",attrs:{type:"text",placeholder:"EA"},domProps:{value:t.signEa},on:{input:[function(r){r.target.composing||e.$set(t,"signEa",r.target.value)},e.formatNum]}})])]):e._e()}))]),e._v(" "),r("br"),e._v(" "),e.voucherInfo?r("p",[e._v(e._s(e.voucherInfo))]):e._e()],1),e._v(" "),r("div",{attrs:{slot:"footer"},slot:"footer"},[r("i-button",{staticStyle:{width:"92px"},on:{click:e.cancel}},[e._v("取消")]),e._v(" "),r("i-button",{staticStyle:{width:"92px"},attrs:{loading:e.submiting,type:"primary"},on:{click:e.submit}},[e._v("确认")])],1)])},o=[];a._withStripped=!0;var s={render:a,staticRenderFns:o};t.default=s},616:function(e,t,r){"use strict";function a(e){l||r(1427)}Object.defineProperty(t,"__esModule",{value:!0});var o=r(1111),s=r.n(o);for(var i in o)"default"!==i&&function(e){r.d(t,e,function(){return o[e]})}(i);var n=r(1429),d=r.n(n),l=!1,c=r(13),u=a,m=c(s.a,d.a,!1,u,"data-v-47bc7625",null);m.options.__file="src/views/trader-manage/order-manage/orderSign.vue",t.default=m.exports},898:function(e,t,r){"use strict";function a(e,t){if(!t)var t="yyyy-MM-DD hh:mm:ss";var r={"M+":e.getMonth()+1,"D+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));for(var a in r)new RegExp("("+a+")").test(t)&&(t=t.replace(RegExp.$1,1===RegExp.$1.length?r[a]:("00"+r[a]).substr((""+r[a]).length)));return t}function o(e,t){if(!t)var t="yyyy-MM-dd";(e=Number(e))<1e10&&(e*=1e3);var r=new Date(e),a={"M+":r.getMonth()+1,"d+":r.getDate(),"h+":r.getHours(),"m+":r.getMinutes(),"s+":r.getSeconds(),"q+":Math.floor((r.getMonth()+3)/3),S:r.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(r.getFullYear()+"").substr(4-RegExp.$1.length)));for(var o in a)new RegExp("("+o+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?a[o]:("00"+a[o]).substr((""+a[o]).length)));return t}Object.defineProperty(t,"__esModule",{value:!0}),t.formatDate=a,t.timestampToDay=o}});