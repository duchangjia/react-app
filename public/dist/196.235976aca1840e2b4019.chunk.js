webpackJsonp([196],{1452:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={formatDate:function(e){if(null===e)return null;var t=new Date(e),a=t.getFullYear(),o=t.getMonth()+1;o=o<10?"0"+o:o;var r=t.getDate();r=r<10?"0"+r:r;var s=t.getHours();s=s<10?"0"+s:s;var n=t.getMinutes();n=n<10?"0"+n:n;var i=t.getSeconds();return i=n<10?"0"+i:i,a+"-"+o+"-"+r+" "+s+":"+n+":"+i}}},1572:function(e,t,a){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=a(65),s=o(r),n=a(1452),i=o(n);t.default={data:function(){var e=this;return{loginOk:!1,loginUrl:"",url:"",formValidate:{name:"",generationType:"",code:"",generationTypeSelect:[{value:"",text:"全部"},{value:0,text:"手动生成"},{value:1,text:"实时生成"},{value:2,text:"门店手动领取"}],state:"",stateSelect:[{value:"",text:"全部"},{value:1,text:"未生效"},{value:2,text:"生效中"},{value:3,text:"已失效"},{value:4,text:"已下架"}]},ruleValidate:{},columns:[{title:"序号",type:"index",width:68,align:"center"},{title:"代金券名称",align:"center",width:100,key:"voucherTypeName"},{title:"代金券编码",align:"center",width:100,key:"voucherTypeCode"},{title:"前缀",align:"center",width:60,key:"cardPrefix"},{title:"代金券金额",align:"center",width:100,key:"voucherPrice"},{title:"活动开始时间",align:"center",width:150,key:"useStartTime",render:function(e,t){return e("div",{},i.default.formatDate(t.row.activityStartTime))}},{title:"活动结束时间",align:"center",width:150,key:"useEndTime",render:function(e,t){return e("div",{},i.default.formatDate(t.row.activityEndTime))}},{title:"生成类型",align:"center",key:"generationType",width:120,render:function(e,t){return e("div",["手动生成","实时生成","门店手动领取 "][t.row.generationType])}},{title:"状态",align:"center",width:100,key:"status",render:function(e,t){return e("div",["未生效","生效中","已失效","已下架"][t.row.status-1])}},{title:"操作",align:"left",key:"handle",width:250,render:function(t,a){var o=a.row.status,r="",s="black";3!==o&&4!==o?r="下架":4===o&&3!==o?r="上架":(s="none",r="失效中");var n=[t("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){e.selectOne(a.row.id,"Select")}}},"查看"),t("Button",{props:{size:"small"},style:{marginRight:"5px"},on:{click:function(){e.Refresh(a.row)}}},"同步缓存"),t("Button",{props:{type:"error",size:"small"},style:{marginRight:"5px",display:s},on:{click:function(){e.shelves(a.row,r)}}},r)];if("上架"===r){var i=t("Button",{props:{type:"warning",size:"small"},style:{marginRight:"5px"},on:{click:function(){e.update(a)}}},"修改");n.push(i)}if(0===a.row.generationType&&1===a.row.status||0===a.row.generationType&&2===a.row.status){var l=t("Button",{props:{type:"info",size:"small"},on:{click:function(){e.addIssue(a)}}},"增发");n.push(l)}return t("div",n)}}],data:[],loading:!1,shelvesText:"",pageParameter:{totalCount:0,currentPage:1,pageSize:10},addIssueModel:{addIssueBoolean:!1,voucherTypeName:"",voucherTypeCode:"",voucherTypeId:"",addIssueNum:""},ruleAddIssueModel:{addIssueNum:[{required:!0,pattern:/^([1-9][0-9]*){1,3}$/,message:"生成数量只能是正整数",trigger:"blur"}]}}},methods:{Refresh:function(e){var t=this;this.$util.ajax.post(this.$util.apiConfig.promotionManage.warProgramme.o2oVoucher.addCacheToRedis,e).then(function(e){200===e.data.code?t.$Message.success("同步缓存成功"):t.$Message.error(e.data.message)})},update:function(e){this.selectOne(e.row.id,"Modify")},VoucherList:function(){this.$router.push({path:"o2o-report-coupon"})},addIssue:function(e){this.addIssueModel.voucherTypeName=e.row.voucherTypeName,this.addIssueModel.voucherTypeCode=e.row.voucherTypeCode,this.addIssueModel.voucherTypeId=e.row.id,this.addIssueModel.addIssueNum="",this.addIssueModel.addIssueBoolean=!0},addIssueCencel:function(){this.$refs.addIssueModel.resetFields(),this.addIssueModel.addIssueBoolean=!1},addIssueOk:function(){var e=this;this.$refs.addIssueModel.validate(function(t){if(t){var a={id:e.addIssueModel.voucherTypeId,generatedQuantity:e.addIssueModel.addIssueNum};e.$util.ajax.post(e.$util.apiConfig.promotionManage.warProgramme.o2oVoucher.addIssue,a).then(function(t){200===t.data.code?e.$Message.success("增发成功,已增发"+e.addIssueModel.addIssueNum+"张"):e.$Message.error(t.data.message),e.addIssueModel.addIssueBoolean=!1})}})},shelves:function(e,t){var a=this,o="";if("下架"===t)o={id:e.id,status:4,generationType:e.generationType};else if("上架"===t){var r="",s=(new Date).getTime(),n=new Date(e.activityStartTime).getTime();r=n>s?1:2,o={id:e.id,status:r,generationType:e.generationType}}this.$util.ajax.post(this.$util.apiConfig.promotionManage.warProgramme.o2oVoucher.updateStatus,o).then(function(e){200===e.data.code?(a.$Message.success(t+"成功"),a.query(a.pageParameter.currentPage)):a.$Message.error(e.data.message)})},selectOne:function(e,t){var a=this,o={id:e};window.localStorage.removeItem("paramsCreateVoucher"),this.$util.ajax.post(this.$util.apiConfig.promotionManage.warProgramme.o2oVoucher.selectOne,o).then(function(e){if(200===e.data.code){if(window.localStorage.setItem("voucherDetail",(0,s.default)(e.data.result)),window.localStorage.setItem("currentPage",a.pageParameter.currentPage),"Modify"===t)return a.$router.push({path:"o2o-report-coupon-create",query:{type:"Modify"}}),!1;a.$router.push({path:"o2o-report-detail"})}else a.$Message.error(e.data.message)})},addVoucher:function(){var e=window.localStorage.getItem("voucherDetail");window.localStorage.removeItem("paramsCreateVoucher"),null!==e&&window.localStorage.removeItem("voucherDetail"),this.$router.push({path:"o2o-report-coupon-create"})},query:function(e){var t=this,a=this.formValidate;this.pageParameter.currentPage=e,this.loading=!0;var o={voucherTypeName:""===a.name?null:a.name,generationType:""===a.generationType?null:a.generationType,status:""===a.state?null:a.state,voucherTypeCode:""===a.code?null:a.code,pager:{page:this.pageParameter.currentPage,rows:this.pageParameter.pageSize}};this.$util.ajax.post(this.$util.apiConfig.promotionManage.warProgramme.o2oVoucher.selectList,o).then(function(e){200===e.data.code&&(t.loading=!1,t.data=e.data.result.rows,t.pageParameter.totalCount=e.data.result.total)})},init:function(){var e=this;this.url="",this.loginOk=!1,this.$util.ajax(e.$util.apiConfig.o2oToken).then(function(t){e.linkTokenLoad=!0,e.url=e.url=e.$util.o2oUrl+"/libuy/singleLogin?token="+t.data.data+"&tourl=listShopVouchers",e.loginOk=!0}).catch(function(){e.$Modal.error({title:"请求O2O Token失败",content:"请求O2O Token失败"})})},recodePage:function(){var e=window.localStorage.getItem("currentPage");e&&(this.pageParameter.currentPage=Number(e),window.localStorage.removeItem("currentPage"))}},mounted:function(){this.recodePage(),this.query(this.pageParameter.currentPage)},watch:{$route:function(e){this.init(),this.recodePage(),this.query(this.pageParameter.currentPage)}}}},1971:function(e,t,a){var o=a(1972);"string"==typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);a(43)("7fda1d37",o,!1,{})},1972:function(e,t,a){t=e.exports=a(42)(!1),t.push([e.i,"\n.addIssue[data-v-f8f067ee] {\n  padding: 12px 0px 0px 0px;\n}\n",""])},1973:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"o2o-present white"},[a("div",{staticClass:"select_box"},[a("Form",{ref:"formValidate",attrs:{model:e.formValidate,rules:e.ruleValidate,"label-width":80,"label-position":"right"}},[a("Row",{staticClass:"head",attrs:{gutter:16}},[a("Col",{attrs:{span:"6"}},[a("FormItem",{staticClass:"margin_bottom_0",attrs:{label:"代金券名称:",prop:"name"}},[a("Input",{attrs:{placeholder:"请输入代金券名称"},model:{value:e.formValidate.name,callback:function(t){e.$set(e.formValidate,"name",t)},expression:"formValidate.name"}})],1)],1),e._v(" "),a("Col",{attrs:{span:"6"}},[a("FormItem",{staticClass:"margin_bottom_0",attrs:{label:"代金券编码:",prop:"code"}},[a("Input",{attrs:{placeholder:"请输入代金券编码"},model:{value:e.formValidate.code,callback:function(t){e.$set(e.formValidate,"code",t)},expression:"formValidate.code"}})],1)],1),e._v(" "),a("Col",{attrs:{span:"5"}},[a("FormItem",{staticClass:"margin_bottom_0",attrs:{label:"生成类型:",prop:"generationType"}},[a("i-select",{model:{value:e.formValidate.generationType,callback:function(t){e.$set(e.formValidate,"generationType",t)},expression:"formValidate.generationType"}},e._l(e.formValidate.generationTypeSelect,function(t,o){return a("i-option",{key:o,attrs:{value:t.value}},[e._v(e._s(t.text))])}))],1)],1),e._v(" "),a("Col",{attrs:{span:"5"}},[a("FormItem",{staticClass:"margin_bottom_0",attrs:{label:"状态:",prop:"state"}},[a("i-select",{model:{value:e.formValidate.state,callback:function(t){e.$set(e.formValidate,"state",t)},expression:"formValidate.state"}},e._l(e.formValidate.stateSelect,function(t,o){return a("i-option",{key:o,attrs:{value:t.value}},[e._v(e._s(t.text))])}))],1)],1),e._v(" "),a("Col",{staticClass:"text_align_right",attrs:{span:"2"}},[a("Button",{attrs:{type:"primary"},on:{click:function(t){e.query(1)}}},[e._v("搜索 ")])],1)],1)],1)],1),e._v(" "),a("div",{staticClass:"list_box"},[a("Row",{staticClass:"operation_box"},[a("Button",{attrs:{type:"primary"},on:{click:e.addVoucher}},[e._v("添加")]),e._v(" "),a("Button",{attrs:{type:"primary"},on:{click:e.VoucherList}},[e._v("代金券列表")])],1),e._v(" "),a("Table",{staticClass:"table",attrs:{loading:e.loading,columns:e.columns,border:"",data:e.data}}),e._v(" "),a("Page",{attrs:{total:e.pageParameter.totalCount,current:e.pageParameter.currentPage,"show-total":"","show-elevator":"","class-name":"page_right"},on:{"on-change":e.query}})],1),e._v(" "),a("Modal",{attrs:{title:"代金券增发","footer-hide":!0},on:{"on-cancel":e.addIssueCencel},model:{value:e.addIssueModel.addIssueBoolean,callback:function(t){e.$set(e.addIssueModel,"addIssueBoolean",t)},expression:"addIssueModel.addIssueBoolean"}},[a("Form",{ref:"addIssueModel",staticStyle:{overflow:"hidden"},attrs:{model:e.addIssueModel,rules:e.ruleAddIssueModel,"label-width":80}},[a("Col",{attrs:{span:12}},[a("FormItem",{attrs:{label:"代金券名称:",prop:"voucherTypeName"}},[e._v("\n          "+e._s(e.addIssueModel.voucherTypeName)+"\n        ")])],1),e._v(" "),a("Col",{attrs:{span:12}},[a("FormItem",{attrs:{label:"代金券编码:",prop:"voucherTypeCode"}},[e._v("\n          "+e._s(e.addIssueModel.voucherTypeCode)+"\n        ")])],1),e._v(" "),a("Col",{attrs:{span:24}},[a("FormItem",{attrs:{label:"增发数量:",prop:"addIssueNum"}},[a("Input",{attrs:{placeholder:"请输入增发数量"},model:{value:e.addIssueModel.addIssueNum,callback:function(t){e.$set(e.addIssueModel,"addIssueNum",t)},expression:"addIssueModel.addIssueNum"}})],1)],1)],1),e._v(" "),a("div",{staticClass:"ivu-modal-footer addIssue"},[a("button",{staticClass:"ivu-btn ivu-btn-text ivu-btn-large",attrs:{type:"button"},on:{click:e.addIssueCencel}},[a("span",[e._v("取消")])]),e._v(" "),a("button",{staticClass:"ivu-btn ivu-btn-primary ivu-btn-large",attrs:{type:"button"},on:{click:e.addIssueOk}},[a("span",[e._v("确定")])])])],1)],1)},r=[];o._withStripped=!0;var s={render:o,staticRenderFns:r};t.default=s},690:function(e,t,a){"use strict";function o(e){u||a(1971)}Object.defineProperty(t,"__esModule",{value:!0});var r=a(1572),s=a.n(r);for(var n in r)"default"!==n&&function(e){a.d(t,e,function(){return r[e]})}(n);var i=a(1973),l=a.n(i),u=!1,d=a(13),c=o,p=d(s.a,l.a,!1,c,"data-v-f8f067ee",null);p.options.__file="src/views/promotion-manage/o2oVoucher/o2oReportCouponType.vue",t.default=p.exports}});