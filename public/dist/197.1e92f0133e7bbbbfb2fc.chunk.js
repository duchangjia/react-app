webpackJsonp([197],{1452:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={formatDate:function(e){if(null===e)return null;var t=new Date(e),a=t.getFullYear(),o=t.getMonth()+1;o=o<10?"0"+o:o;var r=t.getDate();r=r<10?"0"+r:r;var i=t.getHours();i=i<10?"0"+i:i;var n=t.getMinutes();n=n<10?"0"+n:n;var s=t.getSeconds();return s=n<10?"0"+s:s,a+"-"+o+"-"+r+" "+i+":"+n+":"+s}}},1571:function(e,t,a){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=a(239),i=o(r),n=a(1452),s=o(n);t.default={data:function(){var e=this;return{formValidate:{name:"",generationType:"",code:"",generationTypeSelect:[{value:"",text:"全部"},{value:0,text:"手动发放"},{value:1,text:"实时生成"},{value:2,text:"门店手动领取"}],voucherCode:"",storeName:"",salesman:"",state:"",stateSelect:[{code:0,text:"未分配"},{code:1,text:"未使用"},{code:2,text:"已使用"},{code:3,text:"已过期"},{code:4,text:"作废"}],generateBeginTime:"",generateEndTime:"",endTimeOption:{disabledDate:function(t){return t&&t.valueOf()+864e5-1<new Date(e.formValidate.generateBeginTime)}},useStartTimeStr:"",useEndTimeStr:"",useEndTimeOption:{},useStartTimeOption:{},salemanCode:""},pupulForm:{storeCode:null,storeName:null},ruleValidate:{},rules:{},columns:[{type:"selection",align:"center",width:58},{title:"序号",type:"index",width:65,align:"center"},{title:"代金券卡号",key:"voucherCode",width:140,align:"center"},{title:"代金券名称",align:"center",width:100,key:"voucherTypeName"},{title:"代金券编码",align:"center",width:100,key:"voucherTypeCode"},{title:"生成类型",align:"center",key:"generationType",width:120,render:function(e,t){return e("div",["手动生成","实时生成","门店手动领取 "][t.row.generationType])}},{title:"门店名称",align:"center",width:88,key:"storeName"},{title:"业务员编码",align:"center",width:100,key:"salesmanCode"},{title:"业务员名称",align:"center",width:100,key:"salesman"},{title:"代金券金额",align:"center",width:100,key:"voucherPrice"},{title:"生成时间",align:"center",width:150,key:"generateTime",render:function(e,t){return e("div",{},s.default.formatDate(t.row.generateTime))}},{title:"使用开始时间",align:"center",width:150,key:"useStartTime"},{title:"使用结束时间",align:"center",width:150,key:"useEndTime"},{title:"状态",align:"center",width:78,key:"status",render:function(t,a){for(var o=e.formValidate.stateSelect,r=0;r<o.length;r++)if(o[r].code===a.row.status)return t("div",o[r].text)}}],columnStore:[{title:"选中",align:"center",width:68,key:"checkBox",render:function(t,a){return t("div",[t("Checkbox",{props:{value:a.row.checkBox},on:{"on-change":function(t){e.dataStore.forEach(function(t){e.$set(t,"checkBox",!1)}),e.dataStore[a.index].checkBox=t,e.storeListSelect=a.row,console.log(e.storeListSelect)}}})])}},{title:"序号",type:"index",width:68,align:"center"},{title:"门店编号",align:"left",width:120,key:"storeCode"},{title:"门店名称",align:"left",key:"storeName"}],dataStore:[],data:[],loading:!1,pageParameter:{totalCount:0,currentPage:1,pageSize:10},pageParameterStore:{totalCount:0,currentPage:1,pageSize:10},isExportDataLimit:!1,exportBtnText:"导出",storeModel:!1,voucherListSelect:[],storeListSelect:[],distributionBoolean:!1,exportBox:{ExportType:1},exportModalVisible:!1}},mounted:function(){this.init(),this.query(this.pageParameter.currentPage)},created:function(){},methods:{init:function(){var e=this;this.$util.ajax(this.$util.apiConfig.o2oToken).then(function(e){console.log("已经登入")}).catch(function(){e.router.push({path:"/login"})})},VerType:function(){this.$router.push({path:"o2o-report-coupon-type-index"})},handleRowChange:function(e,t){if(e.length<1)return this.distributionBoolean=!1,!1;for(var a=0;a<e.length;a++){if(0!==e[a].status){this.distributionBoolean=!1;break}this.distributionBoolean=!0}this.voucherListSelect=e},distributionStore:function(){this.storeModel=!0,this.queryStore(this.pageParameterStore.currentPage)},asyncOK:function(){var e=this;if(console.log(this.voucherListSelect,this.storeListSelect),this.storeListSelect.checkBox||this.storeListSelect.length<1)return this.$Message.error("请选择分配门店"),!1;var t={itemIds:[],storeId:1001,storeName:"测试门店",storeCode:"6029"};this.voucherListSelect.map(function(e){t.itemIds.push(e.id)}),t.storeId=this.storeListSelect.id,t.storeName=this.storeListSelect.storeName,t.storeCode=this.storeListSelect.storeCode,this.$util.ajax.post(this.$util.apiConfig.promotionManage.warProgramme.o2oVoucher.assignItems,t).then(function(t){200===t.data.code&&(e.$Message.success("分配成功"),e.distributionBoolean=!1,e.storeModel=!1,e.query(e.pageParameter.currentPage))})},asyncCencel:function(){this.storeModel=!1},queryStore:function(e){var t=this;this.pageParameterStore.currentPage=e,this.loading=!0;var a={page:this.pageParameterStore.currentPage,storeCodeLike:this.pupulForm.storeCode,storeNameLike:this.pupulForm.storeName};this.$util.ajax.post(this.$util.apiConfig.promotionManage.warProgramme.o2oVoucher.listSeparation,i.default.stringify(a),{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){200===e.data.code&&(t.loading=!1,t.dataStore=e.data.result.pager.records,t.pageParameterStore.totalCount=e.data.result.pager.totalCount)})},query:function(e){var t=this,a=this.formValidate;this.pageParameter.currentPage=e;var o={voucherCode:""===a.voucherCode?null:a.voucherCode,storeName:""===a.storeName?null:a.storeName,salesman:""===a.salesman?null:a.salesman,status:""===a.state?null:a.state,generateBeginTime:""===a.generateBeginTime?null:a.generateBeginTime,generateEndTime:""===a.generateEndTime?null:a.generateEndTime,useStartTimeStr:""===a.useStartTimeStr?null:a.useStartTimeStr,useEndTimeStr:""===a.useEndTimeStr?null:a.useEndTimeStr,salemanCode:""===a.salemanCode?null:a.salemanCode,voucherTypeName:a.name,voucherTypeCode:a.code,generationType:a.generationType,pager:{page:this.pageParameter.currentPage,rows:this.pageParameter.pageSize}};this.$util.ajax.post(this.$util.apiConfig.promotionManage.warProgramme.o2oVoucher.voucherItem,o).then(function(e){200===e.data.code&&(t.data=e.data.result.rows,t.pageParameter.totalCount=e.data.result.total)})},onStartTimeChange:function(e){this.formValidate.generateBeginTime=e,this.formValidate.generateBeginTime>this.formValidate.generateEndTime&&(this.formValidate.generateEndTime="")},onEndTimeChange:function(e){this.formValidate.generateEndTime=e},onUseStartTimeChange:function(e){var t=this;this.formValidate.useStartTimeStr=e,this.formValidate.useEndTimeOption={disabledDate:function(e){var a=t.formValidate.useStartTimeStr?new Date(t.formValidate.useStartTimeStr).valueOf():"";return e&&e.valueOf()<a}}},onUseEndTimeChange:function(e){this.formValidate.useEndTimeStr=e;var t=this.formValidate.useEndTimeStr?new Date(this.formValidate.useEndTimeStr).valueOf()-864e5:"";this.formValidate.useStartTimeOption={disabledDate:function(e){return e&&e.valueOf()>t}}},exportDate:function(){var e=this,t=this.formValidate,a={voucherCode:""===t.voucherCode?null:t.voucherCode,storeName:""===t.storeName?null:t.storeName,salesman:""===t.salesman?null:t.salesman,status:""===t.state?null:t.state,generateBeginTime:""===t.generateBeginTime?null:t.generateBeginTime,generateEndTime:""===t.generateEndTime?null:t.generateEndTime,useStartTimeStr:""===t.useStartTimeStr?null:t.useStartTimeStr,useEndTimeStr:""===t.useEndTimeStr?null:t.useEndTimeStr,salemanCode:""===t.salemanCode?null:t.salemanCode},o=this.$util.apiConfig.promotionManage.warProgramme.o2oVoucher.uploadVoucherItem;if(2===this.exportBox.ExportType){if(this.voucherListSelect.length<1)return this.$Message.error("请选择要导出的代金卷"),!1;a.IDS="",this.voucherListSelect.map(function(e){a.IDS+=e.id+","}),o=this.$util.apiConfig.promotionManage.warProgramme.o2oVoucher.uploadDesignationVoucherItem}console.log("发送导出请求"),localStorage.repertoryCheckExportDataTimestamp=(new Date).getTime(),this.isExportDataLimit=!0,this.$util.ajax.post(o,i.default.stringify(a),{responseType:"blob"}).then(function(t){if(200===t.status){e.exportModalVisible=!1,console.log("采购发货单导出请求返回数据：",t);var a=new Blob([t.data],{type:"application/x-xls"}),o=new Date,r="代金券管理"+o.getFullYear().toString(),i=(o.getMonth()+1).toString();o.getMonth()+1<10&&(i="0"+(o.getMonth()+1).toString()),r+=i;var n=o.getDate().toString();o.getDate()<10&&(n="0"+o.getDate().toString()),r+=n;var s=o.getHours().toString();o.getHours()<10&&(n="0"+o.getHours().toString()),r+=s;var l=o.getMinutes().toString();o.getMinutes()<10&&(l="0"+o.getMinutes().toString()),r+=l;var u=o.getSeconds().toString();if(o.getSeconds()<10&&(u="0"+o.getSeconds().toString()),r+=u,r+=".xlsx",window.navigator.msSaveOrOpenBlob)navigator.msSaveBlob(a,r);else{var c=document.createElement("a");c.href=window.URL.createObjectURL(a),c.download=r,c.click(),window.URL.revokeObjectURL(c.href)}}else e.$Modal.error({title:"HTTP请求错误",content:t.statusText})}).catch(function(t){console.log(t),e.$Modal.error({title:"HTTP请求错误",content:"HTTP请求错误"})})}},watch:{$route:function(){this.init()}}}},1968:function(e,t,a){var o=a(1969);"string"==typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);a(43)("db178ac4",o,!1,{})},1969:function(e,t,a){t=e.exports=a(42)(!1),t.push([e.i,"",""])},1970:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"o2o-present white"},[a("div",{staticClass:"select_box"},[a("Form",{ref:"formValidate",attrs:{model:e.formValidate,rules:e.ruleValidate,"label-width":80,"label-position":"right"}},[a("Row",[a("Col",{attrs:{span:"24"}},[a("Row",[a("Col",{attrs:{span:"4"}},[a("FormItem",{staticClass:"margin_bottom_0",attrs:{label:"代金券名称:",prop:"name"}},[a("Input",{attrs:{placeholder:"请输入代金券名称"},model:{value:e.formValidate.name,callback:function(t){e.$set(e.formValidate,"name",t)},expression:"formValidate.name"}})],1)],1),e._v(" "),a("Col",{attrs:{span:"4"}},[a("FormItem",{staticClass:"margin_bottom_0",attrs:{label:"代金券编码:",prop:"code"}},[a("Input",{attrs:{placeholder:"请输入代金券编码"},model:{value:e.formValidate.code,callback:function(t){e.$set(e.formValidate,"code",t)},expression:"formValidate.code"}})],1)],1),e._v(" "),a("Col",{attrs:{span:"4"}},[a("FormItem",{staticClass:"margin_bottom_0",attrs:{label:"生成类型:",prop:"generationType"}},[a("i-select",{model:{value:e.formValidate.generationType,callback:function(t){e.$set(e.formValidate,"generationType",t)},expression:"formValidate.generationType"}},e._l(e.formValidate.generationTypeSelect,function(t,o){return a("i-option",{key:o,attrs:{value:t.value}},[e._v(e._s(t.text))])}))],1)],1),e._v(" "),a("Col",{attrs:{span:"4"}},[a("FormItem",{attrs:{label:"卡号:",prop:"voucherCode"}},[a("Input",{model:{value:e.formValidate.voucherCode,callback:function(t){e.$set(e.formValidate,"voucherCode",t)},expression:"formValidate.voucherCode"}})],1)],1),e._v(" "),a("Col",{attrs:{span:"4"}},[a("FormItem",{attrs:{label:"门店名称:",prop:"storeName"}},[a("Input",{model:{value:e.formValidate.storeName,callback:function(t){e.$set(e.formValidate,"storeName",t)},expression:"formValidate.storeName"}})],1)],1),e._v(" "),a("Col",{attrs:{span:"4"}},[a("FormItem",{attrs:{label:"业务员:",prop:"salesman"}},[a("Input",{model:{value:e.formValidate.salesman,callback:function(t){e.$set(e.formValidate,"salesman",t)},expression:"formValidate.salesman"}})],1)],1),e._v(" "),a("Col",{attrs:{span:"6"}},[a("FormItem",{staticClass:"control_width margin_bottom_0",attrs:{label:"用户账号或电话:",prop:"salemanCode"}},[a("Input",{model:{value:e.formValidate.salemanCode,callback:function(t){e.$set(e.formValidate,"salemanCode",t)},expression:"formValidate.salemanCode"}})],1)],1),e._v(" "),a("Col",{attrs:{span:"4"}},[a("FormItem",{attrs:{label:"状态:",prop:"state"}},[a("i-select",{model:{value:e.formValidate.state,callback:function(t){e.$set(e.formValidate,"state",t)},expression:"formValidate.state"}},e._l(e.formValidate.stateSelect,function(t,o){return a("i-option",{key:o,attrs:{value:t.code}},[e._v(e._s(t.text))])}))],1)],1),e._v(" "),a("Col",{attrs:{sm:16,md:12}},[a("FormItem",{attrs:{label:"创建时间:",prop:"generateBeginTime"}},[a("date-picker",{attrs:{type:"datetime",value:e.formValidate.generateBeginTime,placeholder:"请选择时间"},on:{"on-change":e.onStartTimeChange}}),e._v(" "),a("i",{staticClass:"demo-icons"},[e._v("-")]),e._v(" "),a("date-picker",{attrs:{type:"datetime",value:e.formValidate.generateEndTime,placeholder:"请选择时间",options:e.formValidate.endTimeOption},on:{"on-change":e.onEndTimeChange}})],1)],1)],1)],1)],1),e._v(" "),a("Row",[a("Col",{attrs:{sm:16,md:12}},[a("FormItem",{attrs:{label:"使用时间:"}},[a("date-picker",{attrs:{type:"datetime",value:e.formValidate.useStartTimeStr,options:e.formValidate.useStartTimeOption,placeholder:"请选择时间"},on:{"on-change":e.onUseStartTimeChange}}),e._v(" "),a("i",{staticClass:"demo-icons"},[e._v("-")]),e._v(" "),a("date-picker",{attrs:{type:"datetime",value:e.formValidate.useEndTimeStr,placeholder:"请选择时间",options:e.formValidate.useEndTimeOption},on:{"on-change":e.onUseEndTimeChange}})],1)],1),e._v(" "),a("Col",{staticClass:"text_align_right",attrs:{md:12}},[a("Button",{staticClass:"search_btn ",attrs:{type:"primary"},on:{click:function(t){e.query(1)}}},[e._v("搜索 ")])],1)],1)],1)],1),e._v(" "),a("div",{staticClass:"list_box"},[a("Row",{staticClass:"operation_box"},[a("Button",{attrs:{type:"success"},on:{click:function(t){e.exportModalVisible=!0}}},[e._v(e._s(e.exportBtnText))]),e._v(" "),e.distributionBoolean?a("Button",{attrs:{type:"primary"},on:{click:e.distributionStore}},[e._v("分配")]):a("Button",{attrs:{type:"primary",disabled:""}},[e._v("分配")])],1),e._v(" "),a("Table",{staticClass:"table problem_table",attrs:{loading:e.loading,stripe:"",border:"",columns:e.columns,data:e.data},on:{"on-select-all":e.handleRowChange,"on-select":e.handleRowChange,"on-select-cancel":e.handleRowChange}}),e._v(" "),a("Page",{attrs:{total:e.pageParameter.totalCount,"show-total":"","show-elevator":"","class-name":"page_right"},on:{"on-change":e.query}}),e._v(" "),a("div",{staticClass:"text_align_center margin-top-10",staticStyle:{"padding-bottom":"10px"}},[a("Button",{on:{click:e.VerType}},[e._v("返回")])],1)],1),e._v(" "),a("Modal",{attrs:{title:"商品导出"},model:{value:e.exportModalVisible,callback:function(t){e.exportModalVisible=t},expression:"exportModalVisible"}},[a("div",{staticStyle:{"text-align":"center"}},[a("RadioGroup",{model:{value:e.exportBox.ExportType,callback:function(t){e.$set(e.exportBox,"ExportType",t)},expression:"exportBox.ExportType"}},[a("Radio",{staticStyle:{margin:"0 20px"},attrs:{label:1}},[e._v("全部记录")]),e._v(" "),a("Radio",{staticStyle:{margin:"0 20px"},attrs:{label:2}},[e._v("选中记录")])],1)],1),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"primary"},on:{click:e.exportDate}},[e._v("导出")]),e._v(" "),a("Button",{on:{click:function(t){e.exportModalVisible=!1}}},[e._v("取消")])],1)]),e._v(" "),a("Modal",{attrs:{title:"门店信息","footer-hide":!0,width:"800"},on:{"on-cancel":e.asyncCencel},model:{value:e.storeModel,callback:function(t){e.storeModel=t},expression:"storeModel"}},[a("Form",{attrs:{action:"",model:e.pupulForm,"label-position":"right","label-width":90}},[a("Row",[a("div",[a("Col",{attrs:{span:8}},[a("FormItem",{staticClass:"store_right",attrs:{label:"门店编号:",prop:"storeCode"}},[a("Input",{attrs:{placeholder:"请输入门店编号"},model:{value:e.pupulForm.storeCode,callback:function(t){e.$set(e.pupulForm,"storeCode",t)},expression:"pupulForm.storeCode"}})],1)],1),e._v(" "),a("Col",{attrs:{span:8}},[a("FormItem",{staticClass:"store_right",attrs:{label:"门店名称:",prop:"storeName"}},[a("Input",{attrs:{placeholder:"请输入门店名称"},model:{value:e.pupulForm.storeName,callback:function(t){e.$set(e.pupulForm,"storeName",t)},expression:"pupulForm.storeName"}})],1)],1)],1),e._v(" "),a("Col",{staticClass:"text_align_right",attrs:{span:8}},[a("Button",{staticClass:"search_btn",attrs:{type:"primary"},on:{click:function(t){e.queryStore(1)}}},[e._v("搜索 ")])],1)],1)],1),e._v(" "),a("Table",{staticClass:"table",attrs:{loading:e.loading,border:"",height:"300",columns:e.columnStore,data:e.dataStore}}),e._v(" "),a("Page",{attrs:{total:e.pageParameterStore.totalCount,"show-total":"","show-elevator":"","class-name":"page_right"},on:{"on-change":e.queryStore}}),e._v(" "),a("div",{staticClass:"ivu-modal-footer addIssue"},[a("button",{staticClass:"ivu-btn ivu-btn-text ivu-btn-large",attrs:{type:"button"},on:{click:e.asyncCencel}},[a("span",[e._v("取消")])]),e._v(" "),a("button",{staticClass:"ivu-btn ivu-btn-primary ivu-btn-large",attrs:{type:"button"},on:{click:e.asyncOK}},[a("span",[e._v("确定")])])])],1)],1)},r=[];o._withStripped=!0;var i={render:o,staticRenderFns:r};t.default=i},689:function(e,t,a){"use strict";function o(e){u||a(1968)}Object.defineProperty(t,"__esModule",{value:!0});var r=a(1571),i=a.n(r);for(var n in r)"default"!==n&&function(e){a.d(t,e,function(){return r[e]})}(n);var s=a(1970),l=a.n(s),u=!1,c=a(13),d=o,m=c(i.a,l.a,!1,d,"data-v-04ffada2",null);m.options.__file="src/views/promotion-manage/o2oVoucher/o2oReportCoupon.vue",t.default=m.exports}});