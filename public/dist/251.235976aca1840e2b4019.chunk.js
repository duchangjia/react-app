webpackJsonp([251],{1584:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=n(38);!function(t){t&&t.__esModule}(a);e.default={data:function(){var t=this;return{remainingRebateTotal:0,modalPrice:!1,modal_loading:!1,valuePrice:0,columns:[{title:"促销编码",align:"center",key:"promotionNumber"},{title:"促销名称",align:"center",key:"promotionName"},{title:"促销规则",align:"center",key:"promotionRules"},{title:"开始时间",align:"center",key:"startDate"},{title:"结束时间",align:"center",key:"endDate"},{title:"门店编号",align:"center",key:"storesNumber"},{title:"门店名称",align:"center",key:"storesName"},{title:"预计返利总金额",align:"center",key:"estimatedAmount"},{title:"允许返利金额",align:"center",key:"allowAmount"},{title:"操作",key:"action",align:"center",render:function(e,n){return e("div",[e("Button",{props:{type:"primary",size:"small"},style:{margin:"5px 0"},on:{click:function(){t.$router.push({name:"rebate-detail-single-page",query:{promotionCode:n.row.promotionNumber,storeCode:n.row.storesNumber}})}}},"详情")])}}],data:[],columns2:[{title:"促销编码",align:"center",key:"promotionNumber"},{title:"促销名称",align:"center",key:"promotionName"},{title:"促销规则",align:"center",key:"promotionRules"},{title:"开始时间",align:"center",key:"startDate"},{title:"结束时间",align:"center",key:"endDate"},{title:"门店编号",align:"center",key:"storesNumber"},{title:"门店名称",align:"center",key:"storesName"},{title:"剩余返利总金额",align:"center",render:function(t,e){return t("div",e.row.remainingRebateTotal.toFixed(2))}},{title:"预计返利总金额",align:"center",key:"estimatedAmount"},{title:"允许返利金额",align:"center",key:"allowAmount",render:function(e,n){var a="";return 0!==n.row.remainingRebateTotal&&(a=e("Icon",{props:{type:"edit"},style:{cursor:"pointer",marginLeft:"5px"}})),e("div",{props:{width:"100px"},on:{click:function(){0!==n.row.remainingRebateTotal&&t.changePrice(n.row,n.index)}}},[e("Span",{props:{size:"small"}},n.row.allowAmount),a])}},{title:"操作",key:"action",align:"center",render:function(e,n){var a="";return 0!==n.row.remainingRebateTotal&&(a=e("Button",{props:{type:"primary",size:"small"},style:{marginBottom:"5px"},on:{click:function(){t.batch(n.index)}}},"核销")),e("div",[e("Button",{props:{type:"primary",size:"small"},style:{margin:"5px 0"},on:{click:function(){t.$router.push({name:"rebate-detail-single-page",query:{promotionCode:n.row.promotionNumber,storeCode:n.row.storesNumber}})}}},"详情"),a])}}],data2:[],modal1:!1,columns3:[{type:"index",align:"center",width:50},{title:"账号",key:"account",align:"center",width:100},{title:"公司名称",align:"center",key:"companyName"}],data3:[],modalLoding:!0,value:{storesNumber:"",storesName:"",productId:"",productName:""},appliedLoading:!1,notApplyLoading:!1,appliedTotalCount:1,notApplyTotalCount:1,promotionCode:"",uid:"",storeNum:"",bh:[],VerificationDetailList:[],atchApplicationEvent:[],initalData:[]}},mounted:function(){},methods:{iptNum:function(t){var e=t.target.value,n=/^\d+(\.\d{0,2})?$|^\.\d{1,2}$/;if(console.log(e),n.test(e)){if(e>this.remainingRebateTotal)return this.$Message.warning("允许返利金额不能大于剩余返利总金额"),void setTimeout(function(e){return t.target.value=""});this.valuePrice=e,setTimeout(function(n){return t.target.value=e})}else this.valuePrice="",setTimeout(function(e){return t.target.value=""})},confirmPrice:function(){this.data2[this.amountIndex].allowAmount=this.valuePrice,this.initalData[this.amountIndex].allowAmount=this.valuePrice,this.modalPrice=!1},changePrice:function(t,e){this.modalPrice=!0,this.valuePrice=t.allowAmount,this.amountIndex=e,this.remainingRebateTotal=t.remainingRebateTotal},init:function(){this.promotionCode=this.$route.query.promotionCode},query:function(){this.page=1,this.getData()},batch:function(t){var e=this;this.bh=[];for(var n={},a=!1,o=0;o<this.initalData.length;o++)this.data2[t].promotionNumber==this.initalData[o].promotionCode&&(n=this.initalData[o]);if((new Date).getTime()<new Date(this.data2[t].endDate).getTime())return this.$Message.info("已选项中存在未结束活动"),a=!0,!1;if(!a){var i=[],r={};r.allowAmount=this.data2[t].allowAmount,r.applyGoods=n.goodsList,r.applyGoods.forEach(function(t){t.completionRate=t.complete,t.createTime=t.beginDate,t.eaBasePrice=t.price.toFixed(2),t.spuCode=t.code79,t.expectRebateAmount=t.totalAmount}),r.beginDate=n.beginDate,r.endDate=n.endDate,r.promotionCode=n.promotionCode,r.page=n.page,r.rows=n.rows,r.storeCode=n.storeCode,r.storeName=n.storeName,r.title=n.title,r.remainingRebateTotal=n.remainingRebateTotal,i.push(r),this.$Modal.confirm({title:"提示",content:"确定要核销吗?",onOk:function(){e.$ajax({method:"post",url:e.$util.apiConfig.promotionManage.warAdviser.realTimeVerification.rebateVerificationApply,data:i}).then(function(t){200==t.data.code?e.$Modal.confirm({title:"提示",content:"申请核销成功!",onOk:function(){e.getData()}}):e.$Modal.confirm({title:"提示",content:"申请核销失败!",onOk:function(){e.getData()}})}).catch(function(t){console.log("失败信息：",t)})}})}},radio:function(t){var e={};e.dealerCode=1*t.dealerCode,e.dmsAccount=t.account,e.uid=this.uid,e.promotionCodeList=this.bh,this.params=e},changeAppliedPage:function(t){this.applied(t)},changeNotApplyPage:function(t){this.notApply(t)},show:function(t){this.$Modal.info({title:"详情",content:"促销编码："+this.data2[t].promotionNumber+"<br>促销名称："+this.data2[t].promotionName+"<br>促销类型："+this.data2[t].promotionType+"<br>促销规则："+this.data2[t].promotionRules+"<br>开始时间："+this.data2[t].startDate+"<br>结束时间："+this.data2[t].endDate+"<br>门店编号："+this.data2[t].storesNumber+"<br>门店名称："+this.data2[t].storesName+"<br>供货价(件):"+this.data2[t].supplyPrice+"<br>返利："+this.data2[t].rebate+"<br>预计返利金额："+this.data2[t].estimatedAmount+"<br>已达成:"+this.data2[t].haveReached})},remove:function(t){this.data2.splice(t,1)},getUserInfo:function(){var t=this,e={};this.$ajax({method:"post",url:this.$util.apiConfig.purchaseDelivery.purchaseManage.helpSellerOrder.helpSellerOrderAdd.warehouse,data:e}).then(function(e){t.uid=e.data.user.uid,t.getData()}).catch(function(t){console.log("失败信息：",t)})},getData:function(){this.applied(),this.notApply()},parameter:function(){var t={};return t.uid=this.uid,t.promotionInfoDTO={promotionCode:this.promotionCode},t.promotionVerificationDetailDTO={storeCode:"",storeName:"",spuCode:"",itemName:""},t},applied:function(t){var e=this;this.data=[];var n=this.parameter();n.page=t||1,this.appliedLoading=!1,this.$ajax({method:"post",url:this.$util.apiConfig.promotionManage.warAdviser.realTimeVerification.rebateVerificationDetailDoneList,data:n}).then(function(t){e.appliedLoading=!1,e.appliedTotalCount=t.data.result.pager.totalCount,t.data.result.pager.records.map(function(t){1==t.type||(2==t.type||t.type);var n={promotionNumber:t.promotionCode,promotionName:t.title,promotionRules:"满"+t.meetNum+"返"+t.proNum+"%",promotionType:1==t.meetType?"返利":"",startDate:e.formatDate(t.beginDate,"yyyy-MM-DD hh:mm:ss"),endDate:e.formatDate(t.endDate,"yyyy-MM-DD hh:mm:ss"),storesNumber:t.storeCode,storesName:t.storeName,estimatedAmount:t.totalAmount.toFixed(2),allowAmount:t.allowAmount.toFixed(2)};e.data.push(n)})}).catch(function(t){console.log("失败信息：",t)})},notApply:function(t){var e=this;this.data2=[];var n=this.parameter();n.page=t||1,this.notApplyLoading=!0,this.$ajax({method:"post",url:this.$util.apiConfig.promotionManage.warAdviser.realTimeVerification.rebateVerificationDetailUnDoneList,data:n}).then(function(t){e.notApplyLoading=!1,e.notApplyTotalCount=t.data.result.unappliedPager.totalCount,e.initalData=t.data.result.unappliedPager.records,t.data.result.unappliedPager.records.map(function(t){1==t.type||(2==t.type||t.type);var n={promotionNumber:t.promotionCode,promotionName:t.title,startDate:e.formatDate(t.beginDate,"yyyy-MM-DD hh:mm:ss"),endDate:e.formatDate(t.endDate,"yyyy-MM-DD hh:mm:ss"),estimatedAmount:t.totalAmount.toFixed(2),storesNumber:t.storeCode,storesName:t.storeName,allowAmount:t.allowAmount.toFixed(2),promotionType:1==t.meetType?"返利":"",promotionRules:"满"+t.meetNum+"返"+t.proNum+"%",remainingRebateTotal:t.remainingRebateTotal};e.data2.push(n)})}).catch(function(t){console.log("失败信息：",t)})},menoyToString:function(t){if(null==t||t+""=="")return"0.00";var e=String(t);if(-1==String(t).indexOf("."))e+=".00";else if(String(t).indexOf(".")>=0){var n=String(t).indexOf("."),a=String(t).slice(n+1);1==a.length&&(e+="0")}return e},formatDate:function(t,e){if(""===t)return"";var n=new Date;if(n.setTime(t),!e)var e="yyyy-MM-DD hh:mm:ss";var a={"M+":n.getMonth()+1<10?"0"+(n.getMonth()+1):n.getMonth()+1,"D+":n.getDate()<10?"0"+n.getDate():n.getDate(),"h+":n.getHours()<10?"0"+n.getHours():n.getHours(),"m+":n.getMinutes()<10?"0"+n.getMinutes():n.getMinutes(),"s+":n.getSeconds()<10?"0"+n.getSeconds():n.getSeconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(n.getFullYear()+"").substr(4-RegExp.$1.length)));for(var o in a)new RegExp("("+o+")").test(e)&&(e=e.replace(RegExp.$1,1===RegExp.$1.length?a[o]:("00"+a[o]).substr((""+a[o]).length)));return e}},components:{},created:function(){this.init(),this.getUserInfo()}}},2009:function(t,e,n){var a=n(2010);"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);n(43)("738b4054",a,!1,{})},2010:function(t,e,n){e=t.exports=n(42)(!1),e.push([t.i,"\n.width-100 {\n  width: 100%;\n}\n.lb-left {\n  float: left;\n}\n.lb-right {\n  float: right;\n}\n.lb-center {\n  text-align: center;\n}\n.lb-promotion-main {\n  height: auto;\n  background-color: #fff;\n}\n.lb-promotion-main .lb-promotion-search {\n  border-bottom: 1px dashed #e5e5e5;\n}\n.lb-promotion-main .lb-promotion-search .lb-promotion-row {\n  margin-bottom: 14px;\n}\n.lb-promotion-main .lb-promotion-search .lb-promotion-row .ListName {\n  text-align: right;\n  line-height: 32px;\n  color: #747474;\n  font-size: 12px;\n  margin-right: 8px;\n}\n.promotion-page {\n  margin: 1rem 0 0 0;\n}\n.container {\n  background: #fff;\n  color: #747474;\n  border: 1px solid #E8E8E8;\n  padding: 1% 1% 3%;\n}\n.margin-top-8 {\n  margin-top: 8px;\n}\n.margin-top-10 {\n  margin-top: 10px;\n}\n.margin-top-20 {\n  margin-top: 20px;\n}\n.margin-left-10 {\n  margin-left: 10px;\n}\n.margin-bottom-10 {\n  margin-bottom: 10px;\n}\n.margin-bottom-12 {\n  margin-bottom: 12px;\n}\n.margin-bottom-14 {\n  margin-bottom: 14px;\n}\n.margin-bottom-100 {\n  margin-bottom: 100px;\n}\n.margin-right-10 {\n  margin-right: 10px;\n}\n.padding-left-6 {\n  padding-left: 6px;\n}\n.padding-left-8 {\n  padding-left: 5px;\n}\n.padding-left-10 {\n  padding-left: 10px;\n}\n.padding-left-20 {\n  padding-left: 20px;\n}\n.height-100 {\n  height: 100%;\n}\n.height-120px {\n  height: 100px;\n}\n.height-200px {\n  height: 200px;\n}\n.height-492px {\n  height: 492px;\n}\n.height-460px {\n  height: 460px;\n}\n.line-gray {\n  height: 0;\n  border-bottom: 2px solid #dcdcdc;\n}\n.notwrap {\n  word-break: keep-all;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n.padding-left-5 {\n  padding-left: 10px;\n}\n[v-cloak] {\n  display: none;\n}\n.mb--12 {\n  margin-bottom: 12px;\n}\n.mb--14 {\n  margin-bottom: 14px;\n}\n.border-b--dashed {\n  border-bottom: 1px dashed #e5e5e5;\n}\n.pd--20 {\n  padding: 20px;\n}\n.ml--50 {\n  margin-left: 50px;\n}\n.fr {\n  float: right;\n}\n.fl {\n  float: left;\n}\n.bg--white {\n  background: #fff;\n}\n.clearfix:after {\n  content: '';\n  display: block;\n  height: 0;\n  clear: both;\n}\n.text-center {\n  text-align: center;\n}\n.white {\n  background-color: white;\n}\n.select_box {\n  padding: 20px;\n  border-bottom: 1px dashed #E8E8E8;\n}\n.ling_height {\n  padding-top: 15px;\n}\n.text_align_right {\n  text-align: right;\n}\n.text_align_center {\n  text-align: center;\n}\n.operation_box {\n  padding: 10px 20px;\n  text-align: right;\n}\n.page_right {\n  text-align: right;\n  padding: 10px 20px;\n}\n.input_width {\n  width: 120px;\n}\n.search_btn {\n  width: 100px;\n}\n.margin_bottom_0 {\n  margin-bottom: 0;\n}\n.ivu-breadcrumb a {\n  color: #999;\n}\n.ivu-breadcrumb {\n  font-size: 12px;\n}\n.ivu-breadcrumb > span:last-child {\n  color: #426196;\n}\n.box_shadow {\n  box-shadow: 0 1px 6px rgba(0, 0, 0, 0.2);\n  border-color: #eee;\n}\n.border_bottom_dashed {\n  border-bottom: 1px dashed #E8E8E8;\n}\n.problem_table .ivu-checkbox-wrapper {\n  margin-right: 0px;\n}\n.rebate-detail-page {\n  width: 100%;\n  height: 100%;\n  background: #fff;\n  color: #747474;\n  border: 1px solid #E8E8E8;\n  text-align: center;\n  padding: 10px 0;\n}\n.rebate-detail-page .head {\n  padding: 20px 0;\n  border-bottom: 1px dashed #E8E8E8;\n}\n.rebate-detail-page .head .head_left {\n  padding: 10px 0;\n  border-right: 1px dashed #E8E8E8;\n}\n.rebate-detail-page .head .head_left #storesNumber {\n  width: 50%;\n}\n.rebate-detail-page .head .head_left #storesName {\n  width: 50%;\n}\n.rebate-detail-page .head .head_left #productId {\n  width: 50%;\n}\n.rebate-detail-page .head .head_left #productName {\n  width: 50%;\n}\n.rebate-detail-page .head .head_right .query {\n  margin: 10px;\n}\n.rebate-detail-page .table {\n  margin: 1%;\n}\n.rebate-detail-page .page {\n  text-align: right;\n  margin-right: 1%;\n}\n.rebate-detail-page .ti {\n  margin-top: 10px;\n}\n",""])},2011:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"rebate-detail-page"},[n("Row",{staticClass:"head"},[n("Col",{staticClass:"head_left",attrs:{span:"21"}},[n("Row",[n("Col",{attrs:{span:"6"}},[n("label",{attrs:{for:"storesNumber"}},[t._v("门店编号 :  ")]),n("Input",{attrs:{id:"storesNumber"},model:{value:t.value.storesNumber,callback:function(e){t.$set(t.value,"storesNumber",e)},expression:"value.storesNumber"}})],1),t._v(" "),n("Col",{attrs:{span:"6"}},[n("label",{attrs:{for:"storesName"}},[t._v("门店名称 :  ")]),n("Input",{attrs:{id:"storesName"},model:{value:t.value.storesName,callback:function(e){t.$set(t.value,"storesName",e)},expression:"value.storesName"}})],1),t._v(" "),n("Col",{attrs:{span:"6"}},[n("label",{attrs:{for:"productId"}},[t._v("商品编号 :  ")]),n("Input",{attrs:{id:"productId"},model:{value:t.value.productId,callback:function(e){t.$set(t.value,"productId",e)},expression:"value.productId"}})],1),t._v(" "),n("Col",{attrs:{span:"6"}},[n("label",{attrs:{for:"productName"}},[t._v("商品名称 :  ")]),n("Input",{attrs:{id:"productName"},model:{value:t.value.productName,callback:function(e){t.$set(t.value,"productName",e)},expression:"value.productName"}})],1)],1)],1),t._v(" "),n("Col",{staticClass:"head_right",attrs:{span:"3"}},[n("Button",{staticClass:"query",on:{click:t.query}},[t._v("查询")]),n("br")],1)],1),t._v(" "),n("h1",{staticClass:"ti"},[t._v("已申请")]),t._v(" "),n("Table",{staticClass:"table",attrs:{columns:t.columns,data:t.data,loading:t.appliedLoading}}),t._v(" "),n("Page",{attrs:{total:t.appliedTotalCount,"show-total":"","show-elevator":"","class-name":"page"},on:{"on-change":t.changeAppliedPage}}),t._v(" "),n("h1",{staticClass:"ti"},[t._v("未申请")]),t._v(" "),n("Table",{staticClass:"table",attrs:{columns:t.columns2,data:t.data2,loading:t.notApplyLoading}}),t._v(" "),n("Page",{attrs:{total:t.notApplyTotalCount,"show-total":"","show-elevator":"","class-name":"page"},on:{"on-change":t.changeNotApplyPage}}),t._v(" "),n("Modal",{attrs:{title:"修改返利金额",width:"300"},model:{value:t.modalPrice,callback:function(e){t.modalPrice=e},expression:"modalPrice"}},[n("Row",{attrs:{type:"flex",justify:"center",align:"middle"}},[n("Col",{attrs:{span:"4"}},[t._v("价格：")]),t._v(" "),n("Col",{attrs:{span:"20"}},[n("Input",{staticClass:"width200",attrs:{clearable:""},on:{"on-change":function(e){return t.iptNum(e)}},model:{value:t.valuePrice,callback:function(e){t.valuePrice=e},expression:"valuePrice"}})],1)],1),t._v(" "),n("div",{attrs:{slot:"footer"},slot:"footer"},[n("Row",{attrs:{type:"flex",justify:"center",align:"middle"}},[n("Col",{attrs:{span:"12"}}),t._v(" "),n("Col",{attrs:{span:"4"}},[n("Button",{attrs:{type:"text",size:"large"},on:{click:function(e){t.modalPrice=!1}}},[t._v("取消")])],1),t._v(" "),n("Col",{attrs:{span:"2"}}),t._v(" "),n("Col",{attrs:{span:"4"}},[n("Button",{attrs:{type:"primary",size:"large",loading:t.modal_loading},on:{click:t.confirmPrice}},[t._v("\n                        确定\n                    ")])],1),t._v(" "),n("Col",{attrs:{span:"2"}})],1)],1)],1)],1)},o=[];a._withStripped=!0;var i={render:a,staticRenderFns:o};e.default=i},702:function(t,e,n){"use strict";function a(t){d||n(2009)}Object.defineProperty(e,"__esModule",{value:!0});var o=n(1584),i=n.n(o);for(var r in o)"default"!==r&&function(t){n.d(e,t,function(){return o[t]})}(r);var l=n(2011),s=n.n(l),d=!1,p=n(13),m=a,u=p(i.a,s.a,!1,m,null,null);u.options.__file="src/views/promotion-manage/war-adviser/real-time-verification/rebate-promotion-collect/rebate-detail-page/rebate-detail-page.vue",e.default=u.exports}});