webpackJsonp([273],{1544:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(241),r=a(o),u=n(242),i=a(u);t.default={props:{visible:{default:!1,type:Boolean},wareHouseOutList:{default:function(){return[]},type:Array},warehouseIn:{default:{warehouseInCode:"",warehouseInName:""},type:Object},inboundGoods:{default:function(){return[]},type:Array},sourceOrderNo:{default:"",type:String}},data:function(){var e=this;return{apiGroup:this.$util.apiConfig.traderManage.orderManage,modalVisible:!1,loading:!1,editInboundGoods:[],warehouseOut:{warehouseOutCode:"",warehouseOutName:""},editInboundColumns:[{type:"index",width:60,align:"center"},{title:"条形码",align:"center",key:"item69"},{title:"商品名称",align:"center",key:"itemName"},{title:"调拨箱数",align:"center",key:"carNum",render:function(t,n){return t("Input",{props:{value:n.row.carNum},on:{"on-change":function(t){return e.handleInputChange(t,n)}}})}},{title:"调拨散个数",align:"center",key:"eaNum",render:function(t,n){return t("Input",{props:{value:n.row.eaNum},on:{"on-change":function(t){return e.handleInputChange(t,n)}}})}},{title:"库存整箱数",align:"center",key:"carNumKucun"},{title:"库存散个数",align:"center",key:"eaNumKucun"},{title:"操作",align:"center",render:function(t,n){return t("Button",{props:{size:"small"},on:{click:function(t){return e.editInboundGoods.splice(n.index,1)}}},"删除")}}]}},mounted:function(){this.visible&&(this.modalVisible=!0)},methods:{closeModal:function(){this.modalVisible=!1,this.$emit("update:visible",!1)},handleSelectChange:function(e){var t=e.label,n=e.value;this.warehouseOut={warehouseOutCode:n,warehouseOutName:t},this.getWareHouseStock()},handleInputChange:function(e,t){var n=e.target.value,a=parseInt(n),o=t.column.key;if(isNaN(a)||a<0)return setTimeout(function(n){return e.target.value=t.row[o]});a.toString().length!==n.length&&setTimeout(function(t){return e.target.value=a}),t.row[o]=a,this.editInboundGoods[t.index]=t.row},handleVisibleChange:function(e){e||this.$emit("update:visible",!1)},getWareHouseStock:function(){function e(){return t.apply(this,arguments)}var t=(0,i.default)(r.default.mark(function e(){var t,n,a,o=this;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.loading=!0,this.editInboundGoods.forEach(function(e){e.carNumKucun=0,e.eaNumKucun=0}),e.prev=2,t=this.editInboundGoods.map(function(e){return{warehouseCode:o.warehouseOut.warehouseOutCode,materialCode79:e.item79}}),e.next=6,this.$ajax.post(this.apiGroup.warehouseGoodsStock,t);case 6:n=e.sent,a=n.data,a.result instanceof Array&&a.result.length>0&&a.result.forEach(function(e){o.editInboundGoods.forEach(function(t){e.materialCode79==t.item79&&(t.carNumKucun=Math.floor(e.validNum/e.transformRule),t.eaNumKucun=e.validNum%e.transformRule)})}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(2),this.$Message.error("调出仓库库存获取失败");case 14:this.loading=!1;case 15:case"end":return e.stop()}},e,this,[[2,11]])}));return e}(),createDiaoBoDan:function(){function e(){return t.apply(this,arguments)}var t=(0,i.default)(r.default.mark(function e(){var t,n,a,o,u,i,s,c,d,l,h,f=this;return r.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.editInboundGoods.length<=0)){e.next=2;break}return e.abrupt("return",this.$Modal.warning({content:"调拨数量不能为0"}));case 2:if(t=!1,this.editInboundGoods.forEach(function(e){e.eaNum<=0&&e.carNum<=0&&(t=!0)}),!t){e.next=6;break}return e.abrupt("return",this.$Modal.warning({content:"调拨数量不能为0"}));case 6:return n=this.warehouseOut,a=n.warehouseOutCode,o=n.warehouseOutName,u=this.warehouseIn,i=u.warehouseInCode,s=u.warehouseInName,c={sourceOrderNo:this.sourceOrderNo,warehouseOutCode:a,warehouseOutName:o.replace(/' '/g,""),warehouseInCode:i,warehouseInName:s.replace(/' '/g,""),transferOrderUpGoodsList:this.editInboundGoods.map(function(e){return{carNum:e.carNum,carNumKucun:e.carNumKucun,eaNum:e.eaNum,eaNumKucun:e.eaNumKucun,code79:e.item79}})},d="",e.prev=10,e.next=13,this.$ajax.post(this.apiGroup.createDiaoBoDan,c);case 13:l=e.sent,h=l.data,h.success?this.$Modal.success({content:"调拨单创建成功,调拨单号为"+h.message,onOk:function(e){return f.closeModal()}}):d=h.message,e.next=22;break;case 18:e.prev=18,e.t0=e.catch(10),console.error(e.t0),d="调拨单创建失败";case 22:d&&this.$Modal.error({content:d});case 23:case"end":return e.stop()}},e,this,[[10,18]])}));return e}()},watch:{inboundGoods:function(e){this.editInboundGoods=e.concat()},visible:function(e){e&&(this.modalVisible=!0,this.getWareHouseStock())},wareHouseOutList:function(e){if(e.length>0){e[0];this.warehouseOut={warehouseOutCode:e[0].inventoryCode,warehouseOutName:e[0].inventoryName}}}}}},1869:function(e,t,n){var a=n(1870);"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);n(43)("3465abb3",a,!1,{})},1870:function(e,t,n){t=e.exports=n(42)(!1),t.push([e.i,"\n.base-info[data-v-cded27c6] {\n  margin-bottom: 20px;\n}\n.base-info > div[data-v-cded27c6] {\n  line-height: 30px;\n}\n",""])},1871:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("Modal",{attrs:{title:"生成调拨单",width:"900"},on:{"on-visible-change":e.handleVisibleChange},model:{value:e.modalVisible,callback:function(t){e.modalVisible=t},expression:"modalVisible"}},[n("div",[n("Row",{staticClass:"base-info"},[n("Col",{attrs:{span:"8"}},[n("span",[e._v("调出仓库:")]),e._v(" "),n("Select",{staticStyle:{width:"150px"},attrs:{value:e.warehouseOut.warehouseOutCode,"label-in-value":!0},on:{"on-change":e.handleSelectChange}},e._l(e.wareHouseOutList,function(t,a){return n("Option",{key:a,attrs:{value:t.inventoryCode}},[e._v("\n                            "+e._s(t.inventoryName)+"\n                        ")])}))],1),e._v(" "),n("Col",{attrs:{span:"8"}},[n("span",[e._v("调入仓库:")]),e._v(" "),n("span",[e._v(e._s(e.warehouseIn.warehouseInName))])]),e._v(" "),n("Col",{attrs:{span:"8"}},[n("span",[e._v("源订单号:")]),e._v(" "),n("span",[e._v(e._s(e.sourceOrderNo))])])],1),e._v(" "),n("Table",{attrs:{data:e.editInboundGoods,columns:e.editInboundColumns,loading:e.loading}})],1),e._v(" "),n("div",{attrs:{slot:"footer"},slot:"footer"},[n("Button",{attrs:{type:"primary"},on:{click:e.createDiaoBoDan}},[e._v("确定")]),e._v(" "),n("Button",{on:{click:e.closeModal}},[e._v("关闭")])],1)])],1)},o=[];a._withStripped=!0;var r={render:a,staticRenderFns:o};t.default=r},666:function(e,t,n){"use strict";function a(e){c||n(1869)}Object.defineProperty(t,"__esModule",{value:!0});var o=n(1544),r=n.n(o);for(var u in o)"default"!==u&&function(e){n.d(t,e,function(){return o[e]})}(u);var i=n(1871),s=n.n(i),c=!1,d=n(13),l=a,h=d(r.a,s.a,!1,l,"data-v-cded27c6",null);h.options.__file="src/views/my-components/diao-bo-modal/diao-bo-modal.vue",t.default=h.exports}});