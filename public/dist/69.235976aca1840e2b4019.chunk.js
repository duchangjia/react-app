webpackJsonp([69,213,271],{1098:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={data:function(){return{}},props:{total:{type:Number,default:0},current:{type:Number,default:1},pageSizeOpts:{type:Array,default:function(){return[10,20,30,40]}},pageSize:{type:Number,default:10},showSizer:{type:Boolean,default:!0},showTotal:{type:Boolean,default:!0},showElevator:{type:Boolean,default:!0}},methods:{getPage:function(t){this.$emit("getData",t)},getPageSize:function(t){this.$emit("setPageSize",t)}}}},1418:function(t,e,a){var n=a(1419);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);a(43)("00b631b6",n,!1,{})},1419:function(t,e,a){e=t.exports=a(42)(!1),e.push([t.i,"",""])},1420:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"lb-page-contion"},[a("Page",{staticClass:"lb-page",attrs:{total:t.total,current:t.current,"page-size":t.pageSize,"page-size-opts":t.pageSizeOpts,"show-total":t.showTotal,"show-sizer":t.showSizer,"show-elevator":t.showElevator},on:{"on-change":t.getPage,"on-page-size-change":t.getPageSize}})],1)},r=[];n._withStripped=!0;var i={render:n,staticRenderFns:r};e.default=i},1625:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=a(101),i=n(r),o=a(65),s=n(o),l=a(241),u=n(l),c=a(242),d=n(c),p=a(239),f=n(p),h=a(601),g=n(h),m=a(613),y=n(m);e.default={name:"buy-promotion",components:{orderTable:g.default,listPage:y.default},data:function(){var t=this;return{dateE:"",queryArray:{beginDate:"",endDate:"",code:"",title:"",status:"",page:this.current,code79:"",barCode:"",itemName:"",rows:10},cityList:[{label:"请选择",value:""},{label:"未生效",value:"1"},{label:"生效中",value:"2"},{label:"已失效",value:"3"},{label:"已下架",value:"4"}],tableRef:"",selection:[],loading:!0,columnsList:[{type:"selection",width:60,align:"center",fixed:"left"},{title:"序号",type:"index",width:70,align:"center"},{title:"促销编码",key:"promotionCode",align:"center",render:function(e,a){return e("a",{props:{size:"small"},on:{click:function(){t.$router.push({name:"new-buyPromotio-detail",query:{id:a.row.id,mode:"view"}})}}},a.row.promotionCode)}},{title:"促销名称",key:"title",align:"center"},{title:"开始时间",key:"beginDate",width:155,align:"center",render:function(e,a){return e("div",{},t.timestampToTime(a.row.beginDate))}},{title:"结束时间",key:"endDate",width:155,align:"center",render:function(e,a){return e("div",{},t.timestampToTime(a.row.endDate))}},{title:"促销状态",key:"status",width:100,align:"center",render:function(e,a){if(a.row.status)return e("div",t.cityList[a.row.status].label)}},{title:"操作",key:"handel",width:205,align:"center",fixed:"right",render:function(e,a){var n=[e("Button",{props:{size:"small"},style:{marginRight:"2px"},on:{click:function(){t.$router.push({name:"new-buyPromotio-detail",query:{id:a.row.id,mode:"view"}})}}},"查看"),e("Button",{props:{size:"small",type:"info"},style:{marginRight:"2px"},on:{click:function(){t.handleCopyOrModify(a.row.id,"copy")}}},"复制")],r="";return 2==a.row.status?r="下架":4==a.row.status&&(r="上架"),4!=a.row.status&&2!=a.row.status||n.unshift(e("Button",{props:{size:"small",type:"success"},style:{marginRight:"2px"},on:{click:function(){2==a.row.status?t.changeType="下架":4==a.row.status&&(t.changeType="上架"),t.currentId=a.row.id,t.getStatus=a.row.status,t.MoadlShow(a.row.status)}}},r)),1==a.row.status&&n.push(e("Button",{props:{size:"small",type:"error"},style:{marginRight:"2px"},on:{click:function(){t.handleDelte(a.row.id)}}},"删除")),4!=a.row.status&&1!=a.row.status||n.push(e("Button",{props:{size:"small",type:"warning"},style:{marginRight:"2px"},on:{click:function(){t.handleCopyOrModify(a.row.id,"modify")}}},"修改")),e("div",n)}}],thisTableData:[],totalCount:0,current:1,changeModal:!1,changeType:"",currentId:"",getStatus:"",createDateOptions:{disabledDate:function(e){return e&&e.valueOf()+864e5-1<new Date(t.queryArray.beginDate)}}}},methods:{handleRefresh:function(){function t(){return e.apply(this,arguments)}var e=(0,d.default)(u.default.mark(function t(){var e,a,n;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e=this.thisTableData.map(function(t){return t.id}),t.next=4,this.$util.ajax({method:"post",url:this.$util.apiConfig.promotionManage.warProgramme.promoNew.refreshPromotionCache,data:e});case 4:a=t.sent,n=a.data,200==n.code?(this.query(1),this.$Modal.success({title:"提示",content:"刷新成功"})):this.$Modal.error({title:"提示",content:n.message?n.message:"刷新失败"}),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(0),this.$Modal.error({title:"提示",content:t.t0});case 12:case"end":return t.stop()}},t,this,[[0,9]])}));return t}(),setPageSize:function(t){this.queryArray.rows=t,this.query(1)},listenCheckbox:function(t){this.selection=t},handleCopyOrModify:function(){function t(t,a){return e.apply(this,arguments)}var e=(0,d.default)(u.default.mark(function t(e,a){var n,r,i;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.$util.ajax({method:"post",url:this.$util.apiConfig.promotionManage.warProgramme.promoNew.buyPromotionDetail,data:f.default.stringify({id:e})});case 3:n=t.sent,r=n.data,200==r.code?(i=r.result.detail,window.sessionStorage.copyDetail=(0,s.default)(i),this.$router.push({name:"new-buyPromotion-rule-setting",query:{id:e,mode:a}})):this.$Modal.error({title:"提示",content:r.message}),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),this.$Modal.error({title:"提示",content:t.t0});case 11:case"end":return t.stop()}},t,this,[[0,8]])}));return t}(),handleDelte:function(t){var e=function(){var t=(0,d.default)(u.default.mark(function t(){var e,r;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.$util.ajax({method:"post",url:n.$util.apiConfig.promotionManage.warProgramme.promoNew.deletePromotion,data:a});case 2:e=t.sent,r=e.data,200==r.code?(n.$Modal.success({title:"提示",content:"删除成功"}),n.query(n.current)):n.$Modal.error({title:"提示",content:r.message?r.message:"操作失败"});case 5:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),a=[];if("number"==typeof t)a.push(t);else{if(this.selection.length<1)return void this.$Message.error("请选择一条数据");this.selection.forEach(function(t){1==t.status&&a.push(t.id)})}this.$Modal.confirm({title:"提示",content:"您确定要删除未生效活动吗？",onOk:function(){a.length>0&&e()}});var n=this},initNumber:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"queryArray",n=t.target.value,r=/^[A-Z|a-z|_|0-9]*$/;console.log(!r.test(n)),r.test(n)?(this[a][e]=n,setTimeout(function(e){return t.target.value=n})):(this[a][e]="",setTimeout(function(e){return t.target.value=""}))},query:function(t){var e=this;this.current=t,this.queryArray.page=t,this.$util.ajax({method:"post",url:e.$util.apiConfig.promotionManage.warProgramme.buyPromotion.newListUrl,data:f.default.stringify(this.queryArray)}).then(function(t){if(e.loading=!1,200==t.data.code){if(e.thisTableData=[],null==t.data.result.pager.records)return;var a=t.data.result.pager.records;a.forEach(function(t){1!=t.status&&(t._disabled=!0)}),e.thisTableData=a,e.totalCount=t.data.result.pager.totalCount}else e.$Modal.error({title:"提示",content:t.data.message})}).catch(function(t){e.loading=!1,console.log("失败信息：",t)})},MoadlShow:function(t){if(4==t)return void this.checkId();this.changeModal=!0},checkId:function(){var t=this;this.$util.ajax({method:"post",url:t.$util.apiConfig.promotionManage.warProgramme.checkGoodsList,data:{promotionInfoDTO:{id:t.currentId}}}).then(function(e){200==e.data.code?t.changeModal=!0:t.$Modal.error({title:"提示",content:e.data.message})}).catch(function(t){console.log("失败信息：",t)})},handelStatus:function(){var t=this,e="";4==t.getStatus&&(e=2),2==t.getStatus&&(e=4),this.$util.ajax({method:"post",url:this.$util.apiConfig.promotionManage.warProgramme.promoNew.updatePromotionStatus,data:f.default.stringify({id:t.currentId,status:e})}).then(function(e){200==e.data.code?(t.query(t.current),t.$Modal.success({title:"提示",content:"修改成功"})):t.$Modal.error({title:"提示",content:e.data.message})}).catch(function(t){console.log("失败信息：",t)})},newPage:function(){delete window.sessionStorage.buyPromotionEditParams,this.$router.push({name:"new-buyPromotion-rule-setting"})},startTime:function(t){this.queryArray.beginDate=t+" 00:00:00"},endTime:function(t){var e=t,a=this.queryArray.beginDate;if(""!=a){var n=this;a=a=new Date(a).getTime(),e=e=new Date(e).getTime(),a>e?(n.$Modal.error({title:"提示",content:"结束时间不能少于开始时间"}),this.$refs.endDate.handleClear(),this.queryArray.endDate=""):this.queryArray.endDate=t}else this.queryArray.endDate=t},beginTime:function(t){var e=t,a=this.queryArray.endDate;if(""!=a){var n=this;e=e=new Date(e).getTime(),a=a=new Date(a).getTime(),e>a?(n.$Modal.error({title:"提示",content:"结束时间不能少于开始时间"}),this.$refs.beginDate.handleClear(),this.queryArray.beginDate=""):this.queryArray.beginDate=t}else this.queryArray.beginDate=t},timestampToTime:function(t){var e=new Date(t);return e.getFullYear()+"-"+(e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"-"+(e.getDate()<10?"0"+e.getDate():e.getDate())+" "+(e.getHours()<10?"0"+e.getHours():e.getHours())+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+":"+(e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds())},createSTimeChangeHandle:function(t){this.queryArray.beginDate=t,this.queryArray.beginDate>this.queryArray.endDate&&(this.queryArray.endDate="")},createETimeChangeHandle:function(t){this.queryArray.endDate=t},reset:function(){this.queryArray=(0,i.default)(this.queryArray,{beginDate:"",endDate:"",code:"",title:"",status:"",page:1,code79:"",barCode:"",itemName:"",rows:10}),this.query(1)}},mounted:function(){this.query(1)},beforeRouteEnter:function(t,e,a){a(function(t){t.$util.cache.toArr.includes(e.name)&&!e.query.id?t.reset():t.query(t.current)})},beforeRouteLeave:function(t,e,a){(this.$util.cache.fromArr.includes(t.name)&&this.$util.cache.fromArr.includes(e.name)||!this.$util.cache.toArr.includes(t.name)&&this.$util.cache.fromArr.includes(e.name))&&this.reset(),a()}}},2132:function(t,e,a){var n=a(2133);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);a(43)("e5f78ba6",n,!1,{})},2133:function(t,e,a){e=t.exports=a(42)(!1),e.push([t.i,"\n.list-page[data-v-af05ffa8] {\n  height: auto;\n  background: #fff;\n}\n.list-page .list-margin[data-v-af05ffa8] {\n  padding-top: 14px;\n}\n.ListName[data-v-af05ffa8] {\n  text-align: right;\n  line-height: 32px;\n  color: #747474;\n  font-size: 12px;\n  margin-right: 8px;\n}\n.align--center[data-v-af05ffa8] {\n  text-align: center;\n  line-height: 32px;\n}\n.col-group[data-v-af05ffa8] {\n  margin: 0;\n}\n.right[data-v-af05ffa8] {\n  float: right;\n}\n",""])},2134:function(t,e,a){var n=a(2135);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);a(43)("5ce88ef9",n,!1,{})},2135:function(t,e,a){e=t.exports=a(42)(!1),e.push([t.i,"\n.pd--0 .ivu-table-cell {\n  padding: 0;\n}\n.pd--0 .ivu-table-cell .ivu-checkbox-wrapper {\n  margin: 0;\n}\n.margin-20 {\n  margin: 0 20px;\n  padding: 20px 0 0;\n}\n.margin-20 .margin-14 {\n  margin-bottom: 14px;\n}\n",""])},2136:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"list-page"},[a("Row",{staticClass:"margin-20 border-b--dashed"},[a("row",{staticClass:"margin-14"},[a("Col",{attrs:{span:"7"}},[a("Col",{staticClass:"ListName",attrs:{span:"6"}},[t._v("促销编码")]),t._v(" "),a("Col",{attrs:{span:"15"}},[a("Input",{attrs:{value:t.queryArray.promotionCode,clearable:""},on:{"on-change":function(e){return t.initNumber(e,"promotionCode","queryArray")}}})],1)],1),t._v(" "),a("Col",{attrs:{span:"7"}},[a("Col",{staticClass:"ListName",attrs:{span:"6"}},[t._v("促销名称")]),t._v(" "),a("Col",{attrs:{span:"15"}},[a("Input",{staticClass:"width-100",attrs:{clearable:""},model:{value:t.queryArray.title,callback:function(e){t.$set(t.queryArray,"title",e)},expression:"queryArray.title"}})],1)],1),t._v(" "),a("Col",{attrs:{span:"7"}},[a("Col",{staticClass:"ListName",attrs:{span:"6"}},[t._v("促销状态")]),t._v(" "),a("Col",{attrs:{span:"15"}},[a("Select",{staticClass:"width-100",attrs:{clearable:""},model:{value:t.queryArray.status,callback:function(e){t.$set(t.queryArray,"status",e)},expression:"queryArray.status"}},t._l(t.cityList,function(e){return a("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.label))])}))],1)],1)],1),t._v(" "),a("row",{staticClass:"margin-14"},[a("Col",{attrs:{span:"7"}},[a("Col",{staticClass:"ListName",attrs:{span:"6"}},[t._v("开始时间")]),t._v(" "),a("Col",{attrs:{span:"15"}},[a("DatePicker",{staticClass:"width-100",attrs:{type:"datetime",value:t.queryArray.beginDate,placeholder:"请选择时间"},on:{"on-change":t.createSTimeChangeHandle}})],1)],1),t._v(" "),a("Col",{attrs:{span:"7"}},[a("Col",{staticClass:"ListName",attrs:{span:"6"}},[t._v("结束时间")]),t._v(" "),a("Col",{attrs:{span:"15"}},[a("DatePicker",{staticClass:"width-100",attrs:{type:"datetime",value:t.queryArray.endDate,options:t.createDateOptions,placeholder:"请选择时间"},on:{"on-change":t.createETimeChangeHandle}})],1)],1),t._v(" "),a("Col",{attrs:{span:"24"}},[a("Button",{staticClass:"fr",attrs:{type:"primary"},on:{click:function(e){t.query(1)}}},[t._v("查询")])],1)],1)],1),t._v(" "),a("row",{staticClass:"pd--20 list-margin"},[a("row",{staticClass:"mb--12"},[a("Col",{attrs:{span:"24"}},[a("Button",{attrs:{type:"primary"},on:{click:t.newPage}},[t._v("添加")]),t._v(" "),a("Button",{staticClass:"fr",attrs:{type:"success"},on:{click:t.handleRefresh}},[t._v("刷新")]),t._v(" "),a("Button",{staticClass:"right margin-right-10",attrs:{type:"error"},on:{click:t.handleDelte}},[t._v("删除")])],1)],1),t._v(" "),a("order-table",{attrs:{refs:t.tableRef,columnsList:t.columnsList,thisTableData:t.thisTableData,loading:t.loading},on:{listenCheckbox:t.listenCheckbox}}),t._v(" "),a("listPage",{staticClass:"right promotion-page",attrs:{total:t.totalCount,current:t.current,"page-size":t.queryArray.rows},on:{getData:t.query,setPageSize:t.setPageSize}})],1),t._v(" "),a("Modal",{attrs:{title:"提示"},on:{"on-ok":t.handelStatus},model:{value:t.changeModal,callback:function(e){t.changeModal=e},expression:"changeModal"}},[a("p",[t._v("您确定要"+t._s(t.changeType)+"吗？")])])],1)},r=[];n._withStripped=!0;var i={render:n,staticRenderFns:r};e.default=i},601:function(t,e,a){"use strict";function n(t){u||a(900)}Object.defineProperty(e,"__esModule",{value:!0});var r=a(891),i=a.n(r);for(var o in r)"default"!==o&&function(t){a.d(e,t,function(){return r[t]})}(o);var s=a(902),l=a.n(s),u=!1,c=a(13),d=n,p=c(i.a,l.a,!1,d,null,null);p.options.__file="src/views/tables/components/orderTable.vue",e.default=p.exports},613:function(t,e,a){"use strict";function n(t){u||a(1418)}Object.defineProperty(e,"__esModule",{value:!0});var r=a(1098),i=a.n(r);for(var o in r)"default"!==o&&function(t){a.d(e,t,function(){return r[t]})}(o);var s=a(1420),l=a.n(s),u=!1,c=a(13),d=n,p=c(i.a,l.a,!1,d,"data-v-3527b68b",null);p.options.__file="src/views/my-components/list-page/list-page.vue",e.default=p.exports},743:function(t,e,a){"use strict";function n(t){u||(a(2132),a(2134))}Object.defineProperty(e,"__esModule",{value:!0});var r=a(1625),i=a.n(r);for(var o in r)"default"!==o&&function(t){a.d(e,t,function(){return r[t]})}(o);var s=a(2136),l=a.n(s),u=!1,c=a(13),d=n,p=c(i.a,l.a,!1,d,"data-v-af05ffa8",null);p.options.__file="src/views/promotion-manage/war-programme/new-buy-promotion/list.vue",e.default=p.exports},891:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"orderTable",props:{columnsList:Array,thisTableData:Array,getHeight:Number,loading:{type:Boolean,default:!0}},data:function(){return{}},created:function(){this.init()},methods:{init:function(){var t=this;this.columnsList.forEach(function(e){"address1"==e.key&&(e.render=function(e,a){return e("Row",{props:{type:"flex",align:"middle",justify:"center"}},[e("Col",{props:{span:"22"}},a.row.name),e("Col",{props:{span:"2"}},[e("Button",{props:{type:"text",icon:"edit"},on:{click:function(e){t.$emit("showLayer","true")}}})])])})})},a:function(t){this.$emit("listenCheckbox",t)}},watch:{}}},900:function(t,e,a){var n=a(901);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);a(43)("296919d0",n,!1,{})},901:function(t,e,a){e=t.exports=a(42)(!1),e.push([t.i,"\n.show-edit-btn {\n  display: none;\n  margin-left: -10px;\n}\n.ivu-table-cell:hover .show-edit-btn {\n  display: inline-block;\n}\n",""])},902:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Table",{attrs:{height:t.getHeight,columns:t.columnsList,data:t.thisTableData,stripe:"",border:"",loading:t.loading},on:{"on-selection-change":t.a}})],1)},r=[];n._withStripped=!0;var i={render:n,staticRenderFns:r};e.default=i}});