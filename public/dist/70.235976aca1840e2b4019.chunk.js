webpackJsonp([70,241,278],{1410:function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(241),a=i(o),r=n(242),s=i(r),c=n(102),l=i(c),d=n(239),u=i(d);t.default={name:"productSearchCondition",props:{disabled:(0,l.default)({type:Boolean},"type",!1)},data:function(){var e=this;return{loading:!1,tableData:[],brandList:[],categoryList:[],itemCategory21List:[],seriesList:[],modelCategoryData:"",modelBrandData:"",modelSeriesData:"",code69Data:"",itemNameData:"",columns1:[{type:"selection",width:58,align:"center"},{type:"index",title:"序号",width:65,align:"center"},{title:"条形码",align:"center",key:"barCode"},{title:"商品名称",align:"center",key:"itemName"},{title:"价格CAR",align:"center",key:"price"},{title:"价格EA",align:"center",key:"eaPrice"},{title:"品牌",align:"center",key:"brandName"},{title:"品类",align:"center",key:"cname"},{title:"系列",align:"center"},{title:"操作",align:"center",render:function(t,n){return t("Button",{props:{size:"small",disabled:e.disabled},on:{click:function(){e.$emit("on-addItem",n.row)}}},"添加")}}],selected:[],selection:[],totalCount:0,queryArray:{page:1,rows:5,code69:"",code79:"",itemName:"",itemStatus:"4",itemCategory11Id:"",itemCategory21Id:""}}},mounted:function(){this.getProduct(1),this.getSelectType(1)},methods:{isNumber:function(e){return e===+e},handleSectionChange:function(e){this.selection=e},handleAddClick:function(){this.$emit("on-add")},getSelection:function(){return this.$refs.queryTable.getSelection()},getProduct:function(){function e(e){return t.apply(this,arguments)}var t=(0,s.default)(a.default.mark(function e(t){var n,i,o,r,s=this;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.loading=!0,this.queryArray.page=t,e.prev=2,e.next=5,this.$util.ajax({method:"post",url:this.$util.apiConfig.promotionManage.warProgramme.queryGoodsList,data:u.default.stringify(this.queryArray)});case 5:if(n=e.sent,i=n.data,this.loading=!1,200!=i.code){e.next=18;break}if(o=i.result,this.tableData=[],this.totalCount=o.totalCount,r=o.records,0!=r.length){e.next=15;break}return e.abrupt("return");case 15:r.forEach(function(e){var t={code79:e.code79,barCode:e.code69,code80:e.code80,brandId:e.itemCategory11Id,brandName:e.itemCategory11Name,cid:e.itemCategory21Id,cname:e.itemCategory21Name,mustFullMoney:"0",price:s.isNumber(e.marketPrice)?e.marketPrice.toFixed(2):"",eaPrice:s.isNumber(e.marketPrice/e.changeUnitRate)?(e.marketPrice/e.changeUnitRate).toFixed(2):"",guidePrice:e.guidePrice||"",type:1,changeUnitRate:e.changeUnitRate,marketPrice:e.marketPrice,unit:0,dealerId:e.dealerId,itemName:e.itemName,itemId:e.itemId};s.tableData.push(t)}),e.next=19;break;case 18:this.$Message.error(i.message);case 19:e.next=25;break;case 21:e.prev=21,e.t0=e.catch(2),this.loading=!1,console.log(e.t0);case 25:case"end":return e.stop()}},e,this,[[2,21]])}));return e}(),getSelectType:function(){function e(){return t.apply(this,arguments)}var t=(0,s.default)(a.default.mark(function e(){var t,n;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$util.ajax({method:"post",url:this.$util.apiConfig.promotionManage.warProgramme.category});case 3:t=e.sent,n=t.data,n?(this.brandList=n.itemCategory11List,this.itemCategory21List=n.itemCategory21List):this.$Message.error(n.message),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}},e,this,[[0,8]])}));return e}(),getOption:function(e){this.categoryList=[],e?(this.queryArray.itemCategory11Id=e.value,this.queryArray.itemCategory11Name=e.label,this.queryArray.itemCategory21Id="",this.categoryList=this.itemCategory21List.filter(function(t){return t.parentCid==e.value})):(this.queryArray.itemCategory11Id="",this.queryArray.itemCategory21Id="")},getOption1:function(){}}}},1457:function(e,t,n){var i=n(1458);"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);n(43)("3ce6ffaa",i,!1,{})},1458:function(e,t,n){t=e.exports=n(42)(!1),t.push([e.i,"\n.search-form .ivu-form-item {\n  width: 16%;\n  float: left;\n}\n.search-form .section .ivu-input-wrapper {\n  width: 40%;\n}\n.search-form .section .ivu-form-item-content {\n  display: -ms-flexbox;\n  display: flex;\n  -ms-flex-pack: justify;\n      justify-content: space-between;\n}\n",""])},1459:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("Form",{staticClass:"search-form clearfix",attrs:{"label-width":63}},[n("FormItem",{attrs:{label:"条形码"}},[n("Input",{attrs:{clearable:""},model:{value:e.queryArray.code69,callback:function(t){e.$set(e.queryArray,"code69",t)},expression:"queryArray.code69"}})],1),e._v(" "),n("FormItem",{attrs:{label:"商品名称"}},[n("Input",{attrs:{clearable:""},model:{value:e.queryArray.itemName,callback:function(t){e.$set(e.queryArray,"itemName",t)},expression:"queryArray.itemName"}})],1),e._v(" "),n("FormItem",{attrs:{label:"品牌"}},[n("Select",{attrs:{clearable:"","label-in-value":!0},on:{"on-change":e.getOption,"on-clear":e.getOption},model:{value:e.queryArray.itemCategory11Id,callback:function(t){e.$set(e.queryArray,"itemCategory11Id",t)},expression:"queryArray.itemCategory11Id"}},e._l(e.brandList,function(t){return n("Option",{key:t.cid,attrs:{value:t.cid}},[e._v(e._s(t.cName))])}))],1),e._v(" "),n("FormItem",{attrs:{label:"品类"}},[n("Select",{attrs:{clearable:"","label-in-value":!0},on:{"on-change":e.getOption1,"on-clear":e.getOption1},model:{value:e.queryArray.itemCategory21Id,callback:function(t){e.$set(e.queryArray,"itemCategory21Id",t)},expression:"queryArray.itemCategory21Id"}},e._l(e.categoryList,function(t){return n("Option",{key:t.cid,attrs:{value:t.cid}},[e._v(e._s(t.cName))])}))],1),e._v(" "),n("FormItem",{attrs:{label:"系列"}},[n("Select",{attrs:{clearable:"","label-in-value":!0},on:{"on-change":e.getOption1,"on-clear":e.getOption1},model:{value:e.modelSeriesData,callback:function(t){e.modelSeriesData=t},expression:"modelSeriesData"}},e._l(e.seriesList,function(t){return n("Option",{key:t.cid,attrs:{value:t.cid}},[e._v(e._s(t.cName))])}))],1),e._v(" "),n("FormItem",{staticStyle:{width:"220px"}},[n("Button",{on:{click:function(t){e.getProduct(1)}}},[e._v("搜索")]),e._v(" "),n("Button",{attrs:{disabled:e.disabled},on:{click:e.handleAddClick}},[e._v("添加")])],1)],1),e._v(" "),n("Table",{ref:"queryTable",staticClass:"mb--12",attrs:{columns:e.columns1,data:e.tableData,loading:e.loading},on:{"on-selection-change":e.handleSectionChange}}),e._v(" "),n("Row",[n("Page",{staticClass:"fr",attrs:{total:e.totalCount,"page-size":5,"show-total":"","show-elevator":""},on:{"on-change":e.getProduct}})],1)],1)},o=[];i._withStripped=!0;var a={render:i,staticRenderFns:o};t.default=a},1626:function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(65),a=i(o),r=n(241),s=i(r),c=n(146),l=i(c),d=n(242),u=i(d),m=n(239),p=(i(m),n(620)),f=i(p),g=n(602),h=i(g);t.default={components:{productSearchCondition:f.default,steps:h.default},data:function(){var e=this;return{stepsObj:{current:1,data:["定向规则","主品配置","赠品配置","坎级配置","促销预览"]},disabled:!1,conflictMsg:{},conflictModal:!1,showHigherSearch:!1,columns2:[{type:"selection",width:58,align:"center"},{type:"index",title:"序号",width:65,align:"center"},{title:"条形码",align:"center",key:"barCode"},{title:"商品名称",align:"center",key:"itemName"},{title:"价格CAR",align:"center",key:"price"},{title:"价格EA",align:"center",key:"eaPrice"},{title:"品牌",align:"center",key:"brandName"},{title:"品类",align:"cname",key:"cname"},{title:"系列",align:"center"},{title:"数量",align:"center",key:"mustNum",render:function(t,n){return t("Input",{props:{size:"small",value:n.row.mustNum,disabled:e.disabled},on:{"on-blur":function(t){var i=t.target.value;/^[1-9]\d*$/.test(i)?e.selected[n.row._index].mustNum=i:(t.target.value="",e.selected[n.row._index].mustNum="")}}})}}],selected:[],selectedId:[],amountType:!0}},mounted:function(){this.init()},beforeRouteLeave:function(e,t,n){"new-buyPromotion-secProduct"!=e.name&&"new-buyPromotion-rule-setting"!=e.name&&(window.sessionStorage.removeItem("copyDetail"),window.sessionStorage.removeItem("rule"),window.sessionStorage.removeItem("mainProduct"),window.sessionStorage.removeItem("secProduct")),n()},methods:{init:function(){this.mode=this.$route.query.mode;var e=window.sessionStorage.mainProduct;e&&(e=JSON.parse(e),e[0].unit?this.amountType=!1:this.amountType=!0,this.selected=e,this.selected.forEach(function(e){e.mustNum||(e.mustNum=e.mustFullMoney)}));var t=window.sessionStorage.copyDetail;t&&(t=JSON.parse(t),"modify"==this.mode&&(this.disabled=!0))},addItem:function(e){this.disabled||this.isConflict(e)},continueDel:function(){var e=this;this.selected.forEach(function(t,n){t.itemId==e.conflictRow.itemId&&e.selected.splice(n,1)}),this.conflictModal=!1},isNumber:function(e){return e===+e},handleDeleteClick:function(){var e=this;if(!this.disabled){var t=this.$refs.selectedTable.getSelection();if(t.length<=0)return void this.$Message.warning("请先选择一条数据");t.forEach(function(t){var n=e.selectedId.indexOf(t.itemId);n>-1&&e.selectedId.splice(n,1),e.selected=e.selected.filter(function(e){return t.itemId!=e.itemId})})}},add:function(){var e=this;if(!this.disabled){var t=this.$refs.productSearchCondition.getSelection();if(t.length<=0)return void this.$Message.warning("未选中商品");t.forEach(function(t){e.isConflict(t)})}},isConflict:function(){function e(e){return t.apply(this,arguments)}var t=(0,u.default)(s.default.mark(function e(t){var n,i,o,a,r,c,d,u;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=JSON.parse(window.sessionStorage.rule),i=n.promotionInfoDTO,i.beginDate=new Date(i.beginDate).getTime(),i.endDate=new Date(i.endDate).getTime(),i.type=1,i.scope=n.scope,i.isLevel=1,i.channel=i.channel.join(","),o=n.promotionScopeDetailNewDTOList,a=n.promotionStoreScopeExclusionDTOList,r=n.promotionSalemanScopeDTOList,r=r.map(function(e){var t=e.split(",");return{salesmanId:t[0],salesmanCode:t[1],salesmanName:t[2]}}),e.next=14,this.$util.ajax({method:"post",url:this.$util.apiConfig.promotionManage.warProgramme.promoNew.checkGoodsList,data:{promotionGoodsNewList:[t],promotionScopeDetailNewDTOList:o,promotionInfoNewDTO:i,promotionStoreScopeExclusionDTOList:a,promotionSalemanScopeDTOList:r}});case 14:c=e.sent,d=c.data,200==d.code?(window.sessionStorage.mainProduct&&(t.promotionLevelList=JSON.parse(window.sessionStorage.mainProduct)[0].promotionLevelList,t.promotionLevelList&&t.promotionLevelList.length>0&&t.promotionLevelList.forEach(function(e){e.code=e.barCode,e.itemName=e.itemName})),this.selectedId.indexOf(t.itemId)<0&&(this.selectedId.push(t.itemId),this.selected.push(t))):500==d.code?this.$Modal.error({title:"提示",content:d.message}):(d.type=d.result.split("_")[0],d.promotionId=d.result.split("_")[1],u=d.message.match(/\d+/gi),this.conflictMsg=(0,l.default)({},d,{productCode:u[0],activityCode:u[1]}),"1"!=d.type&&(this.selectedId.push(t.itemId),this.selected.push(t)),this.conflictModal=!0,this.conflictRow=t);case 17:case"end":return e.stop()}},e,this)}));return e}(),prev:function(){var e=this.$route.query;this.$router.push({name:"new-buyPromotion-rule-setting",query:e})},next:function(){var e=this;if(this.selected.length<1)return void this.$Message.warning("请选择主品");if((0==this.selected[0].mustNum||!this.selected[0].mustNum)&&2!=this.selected[0].promotionLevelList[0].levelType)return void this.$Message.warning("请输入数量");this.selected.forEach(function(t){t.unit=e.amountType?0:1}),window.sessionStorage.mainProduct=(0,a.default)(this.selected);var t=this.$route.query;this.$router.push({name:"new-buyPromotion-secProduct",query:t})},toConflictPromotion:function(){var e="";4==this.conflictMsg.type?e="/marketing/marketing-center/new-group-goods/new-group-goods-detail?id="+this.conflictMsg.promotionId:3==this.conflictMsg.type?e="/marketing/marketing-center/new-salePromotion-index/new-salePromotion-detail?id="+this.conflictMsg.promotionId:2==this.conflictMsg.type?e="/marketing/marketing-center/rebate-promotion-index/rebatePromotion-detail?id="+this.conflictMsg.promotionId:1==this.conflictMsg.type&&(e="/marketing/marketing-center/new-buy-promotion-index/new-buyPromotio-detail?id="+this.conflictMsg.promotionId+"&mode=view"),window.open(window.location.href.replace(this.$route.fullPath,e),"_blank")}}}},2137:function(e,t,n){var i=n(2138);"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);n(43)("1787edd3",i,!1,{})},2138:function(e,t,n){t=e.exports=n(42)(!1),t.push([e.i,"\n.mainProduct-page .but {\n  text-align: center;\n  padding-bottom: 30px;\n  padding-top: 20px;\n}\n.mainProduct-page .w180 {\n  width: 180px;\n}\n.mainProduct-page-head {\n  margin-bottom: 12px;\n  font-size: 14px;\n  font-weight: bold;\n}\n.mainProduct-page .amount-switch {\n  font-size: 12px;\n  margin-left: 300px;\n}\n",""])},2139:function(e,t,n){var i=n(2140);"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);n(43)("609ef472",i,!1,{})},2140:function(e,t,n){t=e.exports=n(42)(!1),t.push([e.i,"\n.sign-span {\n  font-size: 12px;\n  padding: 2px 3px;\n  color: #fff;\n  margin-right: 5px;\n}\n.sign-span--red {\n  background: red;\n}\n.sign-span--black {\n  background: black;\n}\n.f14 .ivu-modal-body {\n  font-size: 14px;\n}\n",""])},2141:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){var e=this,t=this,n=t.$createElement,i=t._self._c||n;return i("div",[i("steps",{attrs:{stepsObj:t.stepsObj}}),t._v(" "),i("div",{staticClass:"mainProduct-page bg--white pd--20"},[i("p",{staticClass:"mainProduct-page-head"},[t._v("选择主品")]),t._v(" "),i("product-search-condition",{ref:"productSearchCondition",attrs:{disabled:t.disabled},on:{"on-add":t.add,"on-addItem":t.addItem}}),t._v(" "),i("p",{staticClass:"mainProduct-page-head"},[t._v("已选主品")]),t._v(" "),i("div",{staticClass:"mb--12"},[i("Button",{attrs:{disabled:t.disabled},on:{click:t.handleDeleteClick}},[t._v("删 除")]),t._v(" "),i("span",{staticClass:"amount-switch"},[i("span",[t._v("单位")]),t._v(" "),i("i-switch",{attrs:{size:"large",disabled:t.disabled},model:{value:t.amountType,callback:function(e){t.amountType=e},expression:"amountType"}},[i("span",{attrs:{slot:"open"},slot:"open"},[t._v("EA")]),t._v(" "),i("span",{attrs:{slot:"close"},slot:"close"},[t._v("CAR")])])],1)],1),t._v(" "),i("Table",{ref:"selectedTable",attrs:{columns:t.columns2,data:t.selected}}),t._v(" "),i("Row",{staticClass:"but"},[i("Button",{attrs:{size:"large"},on:{click:t.prev}},[t._v("上一步")]),t._v(" "),i("Button",{staticClass:"mr--20",attrs:{type:"primary",size:"large"},on:{click:t.next}},[t._v("下一步")])],1),t._v(" "),i("Modal",{ref:"conflictModal",staticClass:"f14",attrs:{closable:!1,"mask-closable":!1,title:"以下产品在当前执行范围和执行时间段内已配置以下方案，"+(1==t.conflictMsg.type?"不能添加":"是否叠加")},model:{value:t.conflictModal,callback:function(e){t.conflictModal=e},expression:"conflictModal"}},[i("p",[i("span",{staticClass:"sign-span",class:1==t.conflictMsg.type?"sign-span--red":"sign-span--black"},[t._v("\r\n            "+t._s(1==t.conflictMsg.type?"买赠":"特价")+"\r\n          ")]),t._v("\r\n          编码为"),i("a",[t._v(t._s(t.conflictMsg.productCode))]),t._v("\r\n          的产品在活动编码为"),i("a",{on:{click:t.toConflictPromotion}},[t._v(t._s(t.conflictMsg.activityCode))]),t._v("的活动中存在冲突\r\n        ")]),t._v(" "),i("div",{staticClass:"text-center",attrs:{slot:"footer"},slot:"footer"},[1==t.conflictMsg.type?i("Button",{attrs:{type:"primary"},on:{click:function(){e.conflictModal=!1}}},[t._v("确 定")]):i("div",{staticClass:"text-center"},[i("Button",{attrs:{type:"primary"},on:{click:function(){e.conflictModal=!1}}},[t._v("是")]),t._v(" "),i("Button",{on:{click:t.continueDel}},[t._v("否")])],1)],1)])],1)],1)},o=[];i._withStripped=!0;var a={render:i,staticRenderFns:o};t.default=a},602:function(e,t,n){"use strict";function i(e){l||n(946)}Object.defineProperty(t,"__esModule",{value:!0});var o=n(930),a=n.n(o);for(var r in o)"default"!==r&&function(e){n.d(t,e,function(){return o[e]})}(r);var s=n(948),c=n.n(s),l=!1,d=n(13),u=i,m=d(a.a,c.a,!1,u,null,null);m.options.__file="src/views/marketing-centre-components/steps.vue",t.default=m.exports},620:function(e,t,n){"use strict";function i(e){l||n(1457)}Object.defineProperty(t,"__esModule",{value:!0});var o=n(1410),a=n.n(o);for(var r in o)"default"!==r&&function(e){n.d(t,e,function(){return o[e]})}(r);var s=n(1459),c=n.n(s),l=!1,d=n(13),u=i,m=d(a.a,c.a,!1,u,null,null);m.options.__file="src/views/promotion-manage/war-programme/new-buy-promotion/components/product-search-condition.vue",t.default=m.exports},744:function(e,t,n){"use strict";function i(e){l||(n(2137),n(2139))}Object.defineProperty(t,"__esModule",{value:!0});var o=n(1626),a=n.n(o);for(var r in o)"default"!==r&&function(e){n.d(t,e,function(){return o[e]})}(r);var s=n(2141),c=n.n(s),l=!1,d=n(13),u=i,m=d(a.a,c.a,!1,u,null,null);m.options.__file="src/views/promotion-manage/war-programme/new-buy-promotion/main-product-setting.vue",t.default=m.exports},930:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"steps",props:{stepsObj:{type:Object}}}},946:function(e,t,n){var i=n(947);"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);n(43)("62877a53",i,!1,{})},947:function(e,t,n){t=e.exports=n(42)(!1),t.push([e.i,"\n.stepBox {\n  padding: 20px;\n  border-bottom: 1px dashed #E8E8E8;\n  margin-bottom: 10px;\n}\n.bgcolor {\n  background-color: white;\n}\n.ivu-steps-item.ivu-steps-status-wait .ivu-steps-title {\n  color: #AAA;\n}\n",""])},948:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"stepBox bgcolor"},[n("Steps",{attrs:{current:e.stepsObj.current,size:"small"}},e._l(e.stepsObj.data,function(e,t){return n("Step",{key:e,attrs:{title:e}})}))],1)},o=[];i._withStripped=!0;var a={render:i,staticRenderFns:o};t.default=a}});