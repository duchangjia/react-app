webpackJsonp([76,241,278],{1410:function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(241),a=i(r),s=n(242),o=i(s),l=n(102),c=i(l),u=n(239),d=i(u);t.default={name:"productSearchCondition",props:{disabled:(0,c.default)({type:Boolean},"type",!1)},data:function(){var e=this;return{loading:!1,tableData:[],brandList:[],categoryList:[],itemCategory21List:[],seriesList:[],modelCategoryData:"",modelBrandData:"",modelSeriesData:"",code69Data:"",itemNameData:"",columns1:[{type:"selection",width:58,align:"center"},{type:"index",title:"序号",width:65,align:"center"},{title:"条形码",align:"center",key:"barCode"},{title:"商品名称",align:"center",key:"itemName"},{title:"价格CAR",align:"center",key:"price"},{title:"价格EA",align:"center",key:"eaPrice"},{title:"品牌",align:"center",key:"brandName"},{title:"品类",align:"center",key:"cname"},{title:"系列",align:"center"},{title:"操作",align:"center",render:function(t,n){return t("Button",{props:{size:"small",disabled:e.disabled},on:{click:function(){e.$emit("on-addItem",n.row)}}},"添加")}}],selected:[],selection:[],totalCount:0,queryArray:{page:1,rows:5,code69:"",code79:"",itemName:"",itemStatus:"4",itemCategory11Id:"",itemCategory21Id:""}}},mounted:function(){this.getProduct(1),this.getSelectType(1)},methods:{isNumber:function(e){return e===+e},handleSectionChange:function(e){this.selection=e},handleAddClick:function(){this.$emit("on-add")},getSelection:function(){return this.$refs.queryTable.getSelection()},getProduct:function(){function e(e){return t.apply(this,arguments)}var t=(0,o.default)(a.default.mark(function e(t){var n,i,r,s,o=this;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.loading=!0,this.queryArray.page=t,e.prev=2,e.next=5,this.$util.ajax({method:"post",url:this.$util.apiConfig.promotionManage.warProgramme.queryGoodsList,data:d.default.stringify(this.queryArray)});case 5:if(n=e.sent,i=n.data,this.loading=!1,200!=i.code){e.next=18;break}if(r=i.result,this.tableData=[],this.totalCount=r.totalCount,s=r.records,0!=s.length){e.next=15;break}return e.abrupt("return");case 15:s.forEach(function(e){var t={code79:e.code79,barCode:e.code69,code80:e.code80,brandId:e.itemCategory11Id,brandName:e.itemCategory11Name,cid:e.itemCategory21Id,cname:e.itemCategory21Name,mustFullMoney:"0",price:o.isNumber(e.marketPrice)?e.marketPrice.toFixed(2):"",eaPrice:o.isNumber(e.marketPrice/e.changeUnitRate)?(e.marketPrice/e.changeUnitRate).toFixed(2):"",guidePrice:e.guidePrice||"",type:1,changeUnitRate:e.changeUnitRate,marketPrice:e.marketPrice,unit:0,dealerId:e.dealerId,itemName:e.itemName,itemId:e.itemId};o.tableData.push(t)}),e.next=19;break;case 18:this.$Message.error(i.message);case 19:e.next=25;break;case 21:e.prev=21,e.t0=e.catch(2),this.loading=!1,console.log(e.t0);case 25:case"end":return e.stop()}},e,this,[[2,21]])}));return e}(),getSelectType:function(){function e(){return t.apply(this,arguments)}var t=(0,o.default)(a.default.mark(function e(){var t,n;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$util.ajax({method:"post",url:this.$util.apiConfig.promotionManage.warProgramme.category});case 3:t=e.sent,n=t.data,n?(this.brandList=n.itemCategory11List,this.itemCategory21List=n.itemCategory21List):this.$Message.error(n.message),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}},e,this,[[0,8]])}));return e}(),getOption:function(e){this.categoryList=[],e?(this.queryArray.itemCategory11Id=e.value,this.queryArray.itemCategory11Name=e.label,this.queryArray.itemCategory21Id="",this.categoryList=this.itemCategory21List.filter(function(t){return t.parentCid==e.value})):(this.queryArray.itemCategory11Id="",this.queryArray.itemCategory21Id="")},getOption1:function(){}}}},1457:function(e,t,n){var i=n(1458);"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);n(43)("3ce6ffaa",i,!1,{})},1458:function(e,t,n){t=e.exports=n(42)(!1),t.push([e.i,"\n.search-form .ivu-form-item {\n  width: 16%;\n  float: left;\n}\n.search-form .section .ivu-input-wrapper {\n  width: 40%;\n}\n.search-form .section .ivu-form-item-content {\n  display: -ms-flexbox;\n  display: flex;\n  -ms-flex-pack: justify;\n      justify-content: space-between;\n}\n",""])},1459:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("Form",{staticClass:"search-form clearfix",attrs:{"label-width":63}},[n("FormItem",{attrs:{label:"条形码"}},[n("Input",{attrs:{clearable:""},model:{value:e.queryArray.code69,callback:function(t){e.$set(e.queryArray,"code69",t)},expression:"queryArray.code69"}})],1),e._v(" "),n("FormItem",{attrs:{label:"商品名称"}},[n("Input",{attrs:{clearable:""},model:{value:e.queryArray.itemName,callback:function(t){e.$set(e.queryArray,"itemName",t)},expression:"queryArray.itemName"}})],1),e._v(" "),n("FormItem",{attrs:{label:"品牌"}},[n("Select",{attrs:{clearable:"","label-in-value":!0},on:{"on-change":e.getOption,"on-clear":e.getOption},model:{value:e.queryArray.itemCategory11Id,callback:function(t){e.$set(e.queryArray,"itemCategory11Id",t)},expression:"queryArray.itemCategory11Id"}},e._l(e.brandList,function(t){return n("Option",{key:t.cid,attrs:{value:t.cid}},[e._v(e._s(t.cName))])}))],1),e._v(" "),n("FormItem",{attrs:{label:"品类"}},[n("Select",{attrs:{clearable:"","label-in-value":!0},on:{"on-change":e.getOption1,"on-clear":e.getOption1},model:{value:e.queryArray.itemCategory21Id,callback:function(t){e.$set(e.queryArray,"itemCategory21Id",t)},expression:"queryArray.itemCategory21Id"}},e._l(e.categoryList,function(t){return n("Option",{key:t.cid,attrs:{value:t.cid}},[e._v(e._s(t.cName))])}))],1),e._v(" "),n("FormItem",{attrs:{label:"系列"}},[n("Select",{attrs:{clearable:"","label-in-value":!0},on:{"on-change":e.getOption1,"on-clear":e.getOption1},model:{value:e.modelSeriesData,callback:function(t){e.modelSeriesData=t},expression:"modelSeriesData"}},e._l(e.seriesList,function(t){return n("Option",{key:t.cid,attrs:{value:t.cid}},[e._v(e._s(t.cName))])}))],1),e._v(" "),n("FormItem",{staticStyle:{width:"220px"}},[n("Button",{on:{click:function(t){e.getProduct(1)}}},[e._v("搜索")]),e._v(" "),n("Button",{attrs:{disabled:e.disabled},on:{click:e.handleAddClick}},[e._v("添加")])],1)],1),e._v(" "),n("Table",{ref:"queryTable",staticClass:"mb--12",attrs:{columns:e.columns1,data:e.tableData,loading:e.loading},on:{"on-selection-change":e.handleSectionChange}}),e._v(" "),n("Row",[n("Page",{staticClass:"fr",attrs:{total:e.totalCount,"page-size":5,"show-total":"","show-elevator":""},on:{"on-change":e.getProduct}})],1)],1)},r=[];i._withStripped=!0;var a={render:i,staticRenderFns:r};t.default=a},1628:function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(241),a=i(r),s=n(242),o=i(s),l=n(65),c=i(l),u=n(239),d=(i(u),n(620)),m=i(d),p=n(602),f=i(p);t.default={components:{productSearchCondition:m.default,steps:f.default},data:function(){var e=this;return{stepsObj:{current:2,data:["定向规则","主品配置","赠品配置","坎级配置","促销预览"]},disabled:!1,sillLevel:[{itemlist:[{price:1,num:1},{price:2,num:2},{price:2,num:2}],_checked:!1},{itemlist:[{price:3,num:3}],_checked:!1},{itemlist:[{price:4,num:5}],_checked:!1}],selected:[],columns2:[{type:"selection",width:58,align:"center"},{type:"index",title:"序号",width:65,align:"center"},{title:"条形码",align:"center",key:"barCode"},{title:"商品名称",align:"center",key:"itemName"},{title:"价格CAR",align:"center",key:"price"},{title:"价格EA",align:"center",key:"eaPrice"},{title:"品牌",align:"center",key:"brandName"},{title:"品类",align:"center",key:"cname"},{title:"系列",align:"center"},{title:"数量",align:"center",key:"mustNum",render:function(t,n){return t("Input",{props:{size:"small",value:n.row.mustNum,disabled:e.disabled},on:{"on-blur":function(t){var i=t.target.value;/^[1-9]\d*$/.test(i)?e.selected[n.row._index].mustNum=i:(t.target.value="",e.selected[n.row._index].mustNum="")}}})}}],columns3:[{type:"selection",width:55,align:"center"},{type:"index",title:"序号",width:80,align:"center"},{title:"主品坎级",align:"center",children:[{title:"金额",align:"center",key:"mainPrice",render:function(e,t){return e("Input",{props:{size:"small",disabled:this.disabled}})}},{title:"数量",align:"center",key:"mainNum",render:function(e,t){return e("Input",{props:{size:"small",disabled:this.disabled}})}}]},{title:"赠品数量",align:"center",key:"secNum",render:function(e,t){return e("Input",{props:{size:"small",disabled:this.disabled}})}},{title:"操作",align:"center",render:function(t,n){return t("Button",{props:{size:"small",disabled:e.disabled},style:{margin:"5px"},on:{click:function(){e.addList()}}},"增加一行")}}],amountType:!0,amountType1:!0}},mounted:function(){this.init()},beforeRouteLeave:function(e,t,n){"new-buyPromotion-mainProduct"!=e.name&&"new-buyPromotio-detail"!=e.name&&"new-buyPromotion-sillLevel"!=e.name&&(window.sessionStorage.removeItem("copyDetail"),window.sessionStorage.removeItem("rule"),window.sessionStorage.removeItem("mainProduct"),window.sessionStorage.removeItem("secProduct")),n()},methods:{init:function(){this.mode=this.$route.query.mode;var e=window.sessionStorage.secProduct;e&&(e=JSON.parse(e),e[0].unit?this.amountType=!1:this.amountType=!0,this.selected=e);var t=window.sessionStorage.copyDetail;t&&(t=JSON.parse(t),"modify"==this.mode&&(this.disabled=!0))},isNumber:function(e){return e===+e},addRow:function(e){this.sillLevel[e].itemlist.push({price:"",num:"",secNum:""})},addItem:function(e){var t=this;this.disabled||(this.selected.length<1?this.selected.push(e):this.selected.forEach(function(n){n.itemId!=e.itemId&&t.selected.push(e)}))},add:function(){var e=this;if(!this.disabled){var t=this.$refs.productSearchCondition.getSelection();if(t.length<=0)return void this.$Message.warning("请先选择一条数据");this.selected.length<1?this.selected=t:this.selected.forEach(function(n){t.forEach(function(t){n.itemId!=t.itemId&&e.selected.push(t)})})}},handleSillLevelSelected:function(e){this.sillLevel[e]._checked=!this.sillLevel[e]._checked},handleDeleteSillLevel:function(){this.disabled||(this.sillLevel=this.sillLevel.filter(function(e){return!e._checked}))},handleDeleteClick:function(){var e=this,t=this.$refs.selectedTable.getSelection();if(t.length<=0)return void this.$Message.warning("请先选择一条数据");t.forEach(function(t){e.selected=e.selected.filter(function(e){return t.itemId!=e.itemId})})},handleSillLevelClick:function(){var e=this,t=this.$route.query;if(this.selected.length<1)return void this.$Message.error("请选择赠品");var n=!1;if(this.selected.forEach(function(t){t.mustNum||(n=!0),t.type=2,t.unit=e.amountType?0:1}),n)return void this.$Message.error("请填写数量");window.sessionStorage.secProduct=(0,c.default)(this.selected),this.$router.push({name:"new-buyPromotion-sillLevel",query:t})},done:function(){var e=this;if(this.selected.length<1)return void this.$Message.error("未选择赠品");var t=!1;if(this.selected.forEach(function(n){n.mustNum||(t=!0),n.unit=e.amountType?0:1}),t)return void this.$Message.error("请填写数量");this.submitData()},submitData:function(){function e(){return t.apply(this,arguments)}var t=(0,o.default)(a.default.mark(function e(){var t,n;return a.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=void 0,"modify"==this.mode?t=this.$route.query:(t={},t.mode="add"),this.selected.forEach(function(e){e.type=2}),window.sessionStorage.secProduct=(0,c.default)(this.selected),n=JSON.parse(window.sessionStorage.rule).promotionInfoDTO.isLevel,t.isLevel=n||0,this.$router.push({name:"new-buyPromotio-detail",query:t}),e.abrupt("return");case 8:case"end":return e.stop()}},e,this)}));return e}(),prev:function(){var e=this.$route.query;this.$router.push({name:"new-buyPromotion-mainProduct",query:e})}}}},2145:function(e,t,n){var i=n(2146);"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);n(43)("65d88438",i,!1,{})},2146:function(e,t,n){t=e.exports=n(42)(!1),t.push([e.i,"\n.secProduct-page .but {\n  text-align: center;\n  padding-bottom: 30px;\n  padding-top: 20px;\n}\n.secProduct-page .w180 {\n  width: 180px;\n}\n.secProduct-page-head {\n  margin-bottom: 12px;\n  font-size: 14px;\n  font-weight: bold;\n}\n.secProduct-page .amount-switch {\n  font-size: 12px;\n  margin-left: 300px;\n}\n",""])},2147:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("steps",{attrs:{stepsObj:e.stepsObj}}),e._v(" "),n("div",{staticClass:"secProduct-page bg--white pd--20"},[n("p",{staticClass:"secProduct-page-head"},[e._v("选择赠品")]),e._v(" "),n("product-search-condition",{ref:"productSearchCondition",attrs:{disabled:e.disabled},on:{"on-add":e.add,"on-addItem":e.addItem}}),e._v(" "),n("p",{staticClass:"secProduct-page-head"},[e._v("已选赠品")]),e._v(" "),n("div",{staticClass:"mb--12"},[n("Button",{attrs:{disabled:e.disabled},on:{click:e.handleDeleteClick}},[e._v("删 除")]),e._v(" "),n("span",{staticClass:"amount-switch"},[n("span",[e._v("单位")]),e._v(" "),n("i-switch",{attrs:{size:"large",disabled:e.disabled},model:{value:e.amountType,callback:function(t){e.amountType=t},expression:"amountType"}},[n("span",{attrs:{slot:"open"},slot:"open"},[e._v("EA")]),e._v(" "),n("span",{attrs:{slot:"close"},slot:"close"},[e._v("CAR")])])],1)],1),e._v(" "),n("Table",{ref:"selectedTable",staticClass:"mb--12",attrs:{columns:e.columns2,data:e.selected}}),e._v(" "),n("Row",{staticClass:"but"},[n("Button",{staticClass:"mr--20",attrs:{size:"large"},on:{click:e.prev}},[e._v("上一步")]),e._v(" "),n("Button",{attrs:{size:"large",disabled:e.disabled},on:{click:e.handleSillLevelClick}},[e._v("坎 级")]),e._v(" "),n("Button",{attrs:{type:"primary",size:"large"},on:{click:e.done}},[e._v("完 成")])],1)],1)],1)},r=[];i._withStripped=!0;var a={render:i,staticRenderFns:r};t.default=a},602:function(e,t,n){"use strict";function i(e){c||n(946)}Object.defineProperty(t,"__esModule",{value:!0});var r=n(930),a=n.n(r);for(var s in r)"default"!==s&&function(e){n.d(t,e,function(){return r[e]})}(s);var o=n(948),l=n.n(o),c=!1,u=n(13),d=i,m=u(a.a,l.a,!1,d,null,null);m.options.__file="src/views/marketing-centre-components/steps.vue",t.default=m.exports},620:function(e,t,n){"use strict";function i(e){c||n(1457)}Object.defineProperty(t,"__esModule",{value:!0});var r=n(1410),a=n.n(r);for(var s in r)"default"!==s&&function(e){n.d(t,e,function(){return r[e]})}(s);var o=n(1459),l=n.n(o),c=!1,u=n(13),d=i,m=u(a.a,l.a,!1,d,null,null);m.options.__file="src/views/promotion-manage/war-programme/new-buy-promotion/components/product-search-condition.vue",t.default=m.exports},746:function(e,t,n){"use strict";function i(e){c||n(2145)}Object.defineProperty(t,"__esModule",{value:!0});var r=n(1628),a=n.n(r);for(var s in r)"default"!==s&&function(e){n.d(t,e,function(){return r[e]})}(s);var o=n(2147),l=n.n(o),c=!1,u=n(13),d=i,m=u(a.a,l.a,!1,d,null,null);m.options.__file="src/views/promotion-manage/war-programme/new-buy-promotion/second-product-setting.vue",t.default=m.exports},930:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"steps",props:{stepsObj:{type:Object}}}},946:function(e,t,n){var i=n(947);"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);n(43)("62877a53",i,!1,{})},947:function(e,t,n){t=e.exports=n(42)(!1),t.push([e.i,"\n.stepBox {\n  padding: 20px;\n  border-bottom: 1px dashed #E8E8E8;\n  margin-bottom: 10px;\n}\n.bgcolor {\n  background-color: white;\n}\n.ivu-steps-item.ivu-steps-status-wait .ivu-steps-title {\n  color: #AAA;\n}\n",""])},948:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"stepBox bgcolor"},[n("Steps",{attrs:{current:e.stepsObj.current,size:"small"}},e._l(e.stepsObj.data,function(e,t){return n("Step",{key:e,attrs:{title:e}})}))],1)},r=[];i._withStripped=!0;var a={render:i,staticRenderFns:r};t.default=a}});