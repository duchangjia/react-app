webpackJsonp([78,296,297],{1087:function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(241),o=r(s),n=a(242),i=r(n),l=a(146),c=r(l),u=a(239);t.default={props:{visible:{type:Boolean,default:!1},storeCode:{type:String,default:""}},data:function(){var e=this;return{dialogVisible:!1,query:{empName:"",currentPage:1,row:10},empColumns:[{title:"选择",render:function(t,a){return t("input",{attrs:{type:"radio",checked:a.row.checked},on:{change:function(){e.handleEmpSelectChange(a.row)}}})}},{title:"工号",key:"empCode"},{title:"姓名",key:"empName"},{title:"门店数量",key:"storeCount"}],empList:[],total:0}},methods:{handleOk:function(){for(var e=void 0,t=0;t<this.empList.length;t++)this.empList[t].checked&&(e=(0,c.default)({},this.empList[t]));if(!e)return void this.$Message.error("未选择业务员");this.dialogVisible=!1,this.$emit("on-select",e),this.$emit("update:visible",!1)},handleCancel:function(){this.dialogVisible=!1,this.$emit("update:visible",!1)},reloadStoreSelect:function(){this.query={empName:"",currentPage:1,row:10},this.queryEmpList()},handleSearch:function(){this.query.currentPage=1,this.queryEmpList()},queryEmpList:function(){function e(){return t.apply(this,arguments)}var t=(0,i.default)(o.default.mark(function e(){var t,a,r,s;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,c.default)({},this.query,{storeCode:this.storeCode}),delete t.row,a=this,e.prev=3,e.next=6,this.$ajax.post(a.$util.apiConfig.traderManage.flowManage.costManage.queryEmp,u.stringify(t));case 6:r=e.sent,s=r.data,200==r.status?null!=s.dto&&null!=s.page.records&&(this.empList=s.page.records.map(function(e,t){return(0,c.default)({},e,{storeCount:s.dto[t].storeCount,checked:!1})}),this.total=s.page.totalCount||0):this.$Message.error("业务员列表获取失败"),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(3),this.$Message.error("业务员列表获取失败");case 14:case"end":return e.stop()}},e,this,[[3,11]])}));return e}(),handleEmpSelectChange:function(e){var t=this.empList.map(function(t){var a=(0,c.default)({},t);return a.empCode!=e.empCode?a.checked=!1:a.checked=!0,a});this.empList=t}},watch:{visible:function(e,t){1==e?(this.dialogVisible=!0,this.reloadStoreSelect()):this.dialogVisible=!1}}}},1088:function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(241),o=r(s),n=a(242),i=r(n),l=a(146),c=r(l),u=a(239);t.default={props:{visible:{type:Boolean,default:!1}},data:function(){var e=this;return{dialogVisible:!1,query:{storeName:"",storeCode:"",currentPage:1,row:10},storeColumns:[{title:"选择",width:60,render:function(t,a){return t("input",{attrs:{type:"radio",checked:a.row.checked},on:{change:function(){e.handleStoreSelectChange(a.row)}}})}},{title:"门店名称",key:"storeName"},{title:"门店编号",key:"storeCode"},{title:"门店地址",key:"addressDetail"}],storeList:[],total:0}},methods:{handleOk:function(){for(var e=void 0,t=0;t<this.storeList.length;t++)this.storeList[t].checked&&(e=(0,c.default)({},this.storeList[t]));if(!e)return void this.$Message.error("未选择门店");this.dialogVisible=!1,this.$emit("on-select",e),this.$emit("update:visible",!1)},handleCancel:function(){this.$emit("update:visible",!1)},reloadStoreSelect:function(){this.query={storeName:"",storeCode:"",currentPage:1,row:10},this.queryStoreList()},handleSearch:function(){this.query.currentPage=1,this.queryStoreList()},queryStoreList:function(){function e(){return t.apply(this,arguments)}var t=(0,i.default)(o.default.mark(function e(){var t,a,r,s;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,c.default)({},this.query),delete t.row,this.storeList=[],a=this,e.prev=4,e.next=7,this.$ajax({method:"POST",url:a.$util.apiConfig.traderManage.flowManage.costManage.queryStores,data:u.stringify(t)});case 7:r=e.sent,s=r.data,s.records instanceof Array&&(this.storeList=s.records,this.total=s.totalCount||0),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),this.$Message.error("门店列表获取失败");case 15:case"end":return e.stop()}},e,this,[[4,12]])}));return e}(),handleStoreSelectChange:function(e){var t=this.storeList.map(function(t){var a=(0,c.default)({},t);return a.storeCode!=e.storeCode?a.checked=!1:a.checked=!0,a});this.storeList=t}},watch:{visible:function(e,t){1==e?(this.dialogVisible=!0,this.reloadStoreSelect()):this.dialogVisible=!1}}}},1405:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Modal",{attrs:{"mask-closable":!1,title:"选择业务员"},on:{"on-ok":e.handleOk,"on-cancel":e.handleCancel},model:{value:e.dialogVisible,callback:function(t){e.dialogVisible=t},expression:"dialogVisible"}},[a("Row",[a("span",[e._v("业务员")]),e._v(" "),a("Input",{staticStyle:{width:"150px"},attrs:{clearable:""},model:{value:e.query.empName,callback:function(t){e.$set(e.query,"empName",t)},expression:"query.empName"}}),e._v(" "),a("Button",{attrs:{type:"primary"},on:{click:function(t){e.handleSearch()}}},[e._v("查询")])],1),e._v(" "),a("Row",{staticStyle:{"margin-top":"20px"}},[a("Table",{attrs:{height:"280",columns:e.empColumns,data:e.empList}})],1),e._v(" "),a("Row",[a("Page",{staticStyle:{float:"right","margin-top":"20px"},attrs:{current:e.query.currentPage,total:e.total},on:{"update:current":function(t){e.$set(e.query,"currentPage",t)},"on-change":e.queryEmpList}})],1),e._v(" "),a("div",{staticStyle:{overflow:"hidden"},attrs:{slot:"footer"},slot:"footer"},[a("span",{staticStyle:{float:"right"}},[a("Button",{attrs:{size:"large"},on:{click:function(t){e.handleCancel()}}},[e._v("取消")]),e._v(" "),a("Button",{attrs:{type:"primary",size:"large"},on:{click:function(t){e.handleOk()}}},[e._v("确定")])],1)])],1)},s=[];r._withStripped=!0;var o={render:r,staticRenderFns:s};t.default=o},1406:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Modal",{attrs:{"mask-closable":!1,title:"选择门店"},on:{"on-ok":e.handleOk,"on-cancel":e.handleCancel},model:{value:e.dialogVisible,callback:function(t){e.dialogVisible=t},expression:"dialogVisible"}},[a("Row",[a("span",[e._v("门店名称")]),e._v(" "),a("Input",{staticStyle:{width:"150px"},attrs:{clearable:""},model:{value:e.query.storeName,callback:function(t){e.$set(e.query,"storeName",t)},expression:"query.storeName"}}),e._v(" "),a("span",[e._v("门店编码")]),e._v(" "),a("Input",{staticStyle:{width:"150px"},attrs:{clearable:""},model:{value:e.query.storeCode,callback:function(t){e.$set(e.query,"storeCode",t)},expression:"query.storeCode"}}),e._v(" "),a("Button",{attrs:{type:"primary"},on:{click:function(t){e.handleSearch()}}},[e._v("查询")])],1),e._v(" "),a("Row",{staticStyle:{"margin-top":"20px"}},[a("Table",{attrs:{height:"280",columns:e.storeColumns,data:e.storeList}})],1),e._v(" "),a("Row",[a("Page",{staticStyle:{float:"right","margin-top":"20px"},attrs:{current:e.query.currentPage,total:e.total},on:{"update:current":function(t){e.$set(e.query,"currentPage",t)},"on-change":e.queryStoreList}})],1),e._v(" "),a("div",{staticStyle:{overflow:"hidden"},attrs:{slot:"footer"},slot:"footer"},[a("span",{staticStyle:{float:"right"}},[a("Button",{attrs:{size:"large"},on:{click:function(t){e.handleCancel()}}},[e._v("取消")]),e._v(" "),a("Button",{attrs:{type:"primary",size:"large"},on:{click:function(t){e.handleOk()}}},[e._v("确定")])],1)])],1)},s=[];r._withStripped=!0;var o={render:r,staticRenderFns:s};t.default=o},1732:function(e,t,a){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(241),o=r(s),n=a(146),i=r(n),l=a(242),c=r(l),u=a(609),d=r(u),p=a(610),m=r(p),h=a(239);t.default={components:{operatorSelect:d.default,storeSelect:m.default},data:function(){return{editType:0,btnDisable:!1,editId:"",params:{costNo:"",promotionCode:"",costType:"陈列",storeName:"",storeCode:"",empName:"",empCode:"",costAmmout:0,costItem:"",memo:"",openTicketName:""},rules:{storeName:[{required:!0,message:" "}],costType:[{required:!0,message:" "}],costAmmout:[{required:!0,message:" "}]},storeSelectVisible:!1,operatorSelectVisible:!1}},mounted:function(){var e=this.$route.query;e.id&&(this.editType=1,this.editId=e.id),this.getDetail()},methods:{getDetail:function(){function e(){return t.apply(this,arguments)}var t=(0,c.default)(o.default.mark(function e(){var t,a;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this,e.prev=1,e.next=4,this.$ajax({method:"POST",url:t.$util.apiConfig.traderManage.flowManage.costManage.selectByid,headers:{"Content-Type":"application/json;charset=utf-8"},data:this.editId||0});case 4:a=e.sent,200==a.status?a.data.result&&null!==a.data.result&&(this.editId?this.params=(0,i.default)({},a.data.result):this.params.costNo=a.data.result.costNo):this.$Message.error("费用单数据获取失败"),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),this.$Message.error("费用单数据获取失败");case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return e}(),handleOperatorSelect:function(e){this.params.empName=e.empName,this.params.empCode=e.empCode,this.$Modal.success({content:"添加成功"})},handleStoreSelect:function(e){this.params.storeName=e.storeName,this.params.storeCode=e.storeCode,this.params.openTicketName=e.openTicketName,this.params.customizeClientId=e.customizeClientId,this.afterStoreSelect()},afterStoreSelect:function(){function e(){return t.apply(this,arguments)}var t=(0,c.default)(o.default.mark(function e(){var t,a,r,s,n,i,l;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.params.empName="",this.params.empCode="",t=this,e.prev=3,e.next=6,this.$ajax.post(t.$util.apiConfig.traderManage.flowManage.costManage.queryEmp,h.stringify({currentPage:1,storeCode:this.params.storeCode}));case 6:a=e.sent,r=a.data,r.page.records instanceof Array&&r.page.records.length>0&&(this.params.empName=r.page.records[0].empName,this.params.empCode=r.page.records[0].empCode),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(3),this.$Message.error("默认业务员添加失败");case 14:return e.prev=14,e.next=17,this.$ajax.post(t.$util.apiConfig.traderManage.flowManage.costManage.storeAddress,h.stringify({storeCode:this.params.storeCode}));case 17:if(s=e.sent,-1==(n=s.data));else if(1==n){if(i=document.cookie.match(/[^ =;]+(?=\=)/g))for(l=i.length;l--;)document.cookie=i[l]+"=0;expires="+new Date(0).toUTCString();this.$store.commit("logout",this),window.location.reload()}else 2==n?this.$Modal.error({content:"当前选择门店数据有问题!"}):this.$Modal.success({content:"添加成功"});e.next=25;break;case 22:e.prev=22,e.t1=e.catch(14),this.$Message.error("门店检测失败");case 25:this.$refs.storeSelect.dialogVisible=!1;case 26:case"end":return e.stop()}},e,this,[[3,11],[14,22]])}));return e}(),handleCostAmmoutChange:function(e){var t=this,a=e.target.value;a=a.replace(/[^-\d.]/g,""),a=a.replace(/^\./g,""),a=a.replace(/\.{2,}/g,"."),a=a.replace(".","$#$").replace(/\./g,"").replace("$#$","."),a=a.replace(/^(\-)*(\d+)\.(\d\d).*$/,"$1$2.$3"),setTimeout(function(e){return t.params.costAmmout=a})},saveOrUpdate:function(){function e(){return t.apply(this,arguments)}var t=(0,c.default)(o.default.mark(function e(){var t,a,r,s,n,l,c,u,d=this;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.params.storeName){e.next=2;break}return e.abrupt("return",this.$Modal.error({content:"门店不能为空"}));case 2:if(this.params.costType){e.next=4;break}return e.abrupt("return",this.$Modal.error({content:"费用类型不能为空"}));case 4:if(this.params.costAmmout){e.next=6;break}return e.abrupt("return",this.$Modal.error({content:"费用金额不能为空"}));case 6:if(!isNaN(parseFloat(this.params.costAmmout))){e.next=8;break}return e.abrupt("return",this.$Modal.error({content:"费用金额必须是数字"}));case 8:if(t=(0,i.default)({},this.params),this.btnDisable=!0,a="",r="修改成功",s="修改失败",n=this,this.editType)a=n.$util.apiConfig.traderManage.flowManage.costManage.update;else{a=n.$util.apiConfig.traderManage.flowManage.costManage.addCostInfo,r="新建成功",s="新建失败";for(l in t)null===t[l]&&(t[l]="")}return c={},e.prev=16,e.next=19,this.$ajax.post(a,t);case 19:u=e.sent,c=u.data,e.next=26;break;case 23:e.prev=23,e.t0=e.catch(16),c={success:!1};case 26:c.success?this.$Modal.success({content:r,onOk:function(){d.$router.go(-1)}}):this.$Modal.error({content:s}),this.btnDisable=!1;case 28:case"end":return e.stop()}},e,this,[[16,23]])}));return e}()},watch:{$route:function(e){e.query.id?(this.editType=1,this.editId=e.query.id):(this.params={costNo:"",promotionCode:"",costType:"陈列",storeName:"",storeCode:"",empName:"",empCode:"",costAmmout:0,memo:"",openTicketName:""},this.editType=0,this.editId=null),this.getDetail()}}}},2498:function(e,t,a){var r=a(2499);"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);a(43)("5d871622",r,!1,{})},2499:function(e,t,a){t=e.exports=a(42)(!1),t.push([e.i,"\n.store-manage-edit[data-v-27c91884] {\n  min-height: 600px;\n  padding-top: 30px;\n}\n.wid-150[data-v-27c91884] {\n  width: 150px;\n}\n.wid-300[data-v-27c91884] {\n  width: 300px;\n}\n.btn-group[data-v-27c91884] {\n  text-align: center;\n}\n.btn-group .btn[data-v-27c91884] {\n  width: 150px;\n  font-size: 14px;\n}\n.btn-group .btn[data-v-27c91884]:first-of-type {\n  margin-right: 30px;\n}\n",""])},2500:function(e,t,a){var r=a(2501);"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);a(43)("30e4c67c",r,!1,{})},2501:function(e,t,a){t=e.exports=a(42)(!1),t.push([e.i,"\n.store-manage-edit textarea.ivu-input {\n  overflow: hidden;\n}\n",""])},2502:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Card",{staticClass:"store-manage-edit"},[a("Form",{attrs:{"label-width":100,model:e.params,rules:e.rules}},[a("FormItem",{attrs:{label:"费用单号"}},[a("Input",{staticClass:"wid-150",attrs:{disabled:"",value:e.params.costNo}})],1),e._v(" "),a("FormItem",{attrs:{label:"促销编码"}},[a("Input",{staticClass:"wid-150",attrs:{disabled:"",value:e.params.promotionCode}})],1),e._v(" "),a("FormItem",{attrs:{label:"门店选择",prop:"storeName"}},[a("span",{on:{click:function(t){return e.storeSelectVisible=!0}}},[a("Input",{staticClass:"wid-150",attrs:{readonly:"",placeholder:"请选择门店"},model:{value:e.params.storeName,callback:function(t){e.$set(e.params,"storeName",t)},expression:"params.storeName"}})],1)]),e._v(" "),a("FormItem",{attrs:{label:"开票名称"}},[a("Input",{staticClass:"wid-150",attrs:{value:e.params.openTicketName,readonly:""}})],1),e._v(" "),a("FormItem",{attrs:{label:"业务员选择"}},[a("span",[a("Input",{staticClass:"wid-150",attrs:{placeholder:"请选择业务员"},model:{value:e.params.empName,callback:function(t){e.$set(e.params,"empName",t)},expression:"params.empName"}}),e._v(" "),a("Button",{on:{click:function(t){return e.operatorSelectVisible=!0}}},[e._v("选择")])],1)]),e._v(" "),a("FormItem",{attrs:{label:"费用类型",prop:"costType"}},[a("Select",{staticClass:"wid-150",attrs:{placement:"bottom",transfer:!0},model:{value:e.params.costType,callback:function(t){e.$set(e.params,"costType",t)},expression:"params.costType"}},[a("Option",{attrs:{value:"陈列"}},[e._v("陈列")]),e._v(" "),a("Option",{attrs:{value:"进场"}},[e._v("进场")]),e._v(" "),a("Option",{attrs:{value:"赠品"}},[e._v("赠品")]),e._v(" "),a("Option",{attrs:{value:"特价补差"}},[e._v("特价补差")]),e._v(" "),a("Option",{attrs:{value:"合同折扣"}},[e._v("合同折扣")]),e._v(" "),a("Option",{attrs:{value:"商业返利"}},[e._v("商业返利")]),e._v(" "),a("Option",{attrs:{value:"宣导会"}},[e._v("宣导会")]),e._v(" "),a("Option",{attrs:{value:"订货会"}},[e._v("订货会")]),e._v(" "),a("Option",{attrs:{value:"卖场罚款"}},[e._v("卖场罚款")]),e._v(" "),a("Option",{attrs:{value:"物料制作"}},[e._v("物料制作")]),e._v(" "),a("Option",{attrs:{value:"其他"}},[e._v("其他")])],1)],1),e._v(" "),a("FormItem",{attrs:{label:"费用项目"}},[a("Input",{staticClass:"wid-150",model:{value:e.params.costItem,callback:function(t){e.$set(e.params,"costItem",t)},expression:"params.costItem"}})],1),e._v(" "),a("FormItem",{attrs:{label:"费用金额",prop:"costAmmout"}},[a("Input",{staticClass:"wid-150",on:{"on-change":e.handleCostAmmoutChange},model:{value:e.params.costAmmout,callback:function(t){e.$set(e.params,"costAmmout",t)},expression:"params.costAmmout"}})],1),e._v(" "),a("FormItem",{attrs:{label:"备注信息"}},[a("Input",{staticClass:"wid-300",attrs:{autosize:{minRows:4},maxlength:50,type:"textarea",placeholder:"最多50字"},model:{value:e.params.memo,callback:function(t){e.$set(e.params,"memo",t)},expression:"params.memo"}})],1),e._v(" "),a("Row",{staticClass:"btn-group"},[a("Button",{staticClass:"btn",attrs:{type:"primary",disabled:e.btnDisable},on:{click:function(t){e.saveOrUpdate()}}},[a("span",{directives:[{name:"show",rawName:"v-show",value:1==e.editType,expression:"editType == 1"}]},[e._v("修改")]),e._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:0==e.editType,expression:"editType == 0"}]},[e._v("保存")])]),e._v(" "),a("Button",{staticClass:"btn",attrs:{type:"primary",disabled:e.btnDisable},on:{click:function(t){e.$router.go(-1)}}},[e._v("取消")])],1)],1),e._v(" "),a("store-select",{ref:"storeSelect",attrs:{visible:e.storeSelectVisible},on:{"update:visible":function(t){e.storeSelectVisible=t},"on-select":e.handleStoreSelect}}),e._v(" "),a("operator-select",{attrs:{visible:e.operatorSelectVisible,"store-code":this.params.storeCode},on:{"update:visible":function(t){e.operatorSelectVisible=t},"on-select":e.handleOperatorSelect}})],1)},s=[];r._withStripped=!0;var o={render:r,staticRenderFns:s};t.default=o},609:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a(1087),s=a.n(r);for(var o in r)"default"!==o&&function(e){a.d(t,e,function(){return r[e]})}(o);var n=a(1405),i=a.n(n),l=a(13),c=l(s.a,i.a,!1,null,null,null);c.options.__file="src/views/my-components/modal-selector/operator-select-modal.vue",t.default=c.exports},610:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a(1088),s=a.n(r);for(var o in r)"default"!==o&&function(e){a.d(t,e,function(){return r[e]})}(o);var n=a(1406),i=a.n(n),l=a(13),c=l(s.a,i.a,!1,null,null,null);c.options.__file="src/views/my-components/modal-selector/store-select-modal.vue",t.default=c.exports},847:function(e,t,a){"use strict";function r(e){c||(a(2498),a(2500))}Object.defineProperty(t,"__esModule",{value:!0});var s=a(1732),o=a.n(s);for(var n in s)"default"!==n&&function(e){a.d(t,e,function(){return s[e]})}(n);var i=a(2502),l=a.n(i),c=!1,u=a(13),d=r,p=u(o.a,l.a,!1,d,"data-v-27c91884",null);p.options.__file="src/views/trader-manage/flow-manage/cost-manage/edit.vue",t.default=p.exports}});