webpackJsonp([84,274],{1704:function(t,e,a){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=a(65),i=n(r),o=a(241),l=n(o),s=a(146),u=n(s),c=a(242),p=n(c),d=a(898),f=a(603),h=n(f),v=a(239);e.default={components:{DefaultHr:h.default},data:function(){var t=this;return{query:{countBillNo:"",status:"",page:1,row:10},apiGroup:this.$util.apiConfig.stockManage.countBillManage.bill,loading:!1,total:0,tableData:[],tableColumns:[{title:"序号",width:75,align:"center",render:function(e,a){return e("span",(t.query.page-1)*t.query.row+a.index+1)}},{title:"盘点单号",align:"center",key:"countBillNo"},{title:"盘点日期",align:"center",key:"createTime",render:function(t,e){var a="",n=parseInt(e.row.createTime);return n>0&&(a=(0,d.formatDate)(new Date(1e3*n),"yyyy-MM-DD")),t("span",a)}},{title:"盘点单状态",align:"center",key:"status",render:function(e,a){return e("span",t.billStatusText(a.row.status))}},{title:"仓库",align:"center",key:"warehouseName"},{title:"商品种类",align:"center",key:"itemCategoryNum"},{title:"盘点人",align:"center",key:"creatorName"},{title:"操作",align:"center",width:160,render:function(e,a){var n=[];return n.push(e("Button",{props:{type:"primary",size:"small"},on:{click:function(e){return t.showDetail(a.row,0)}}},"查看")),0==a.row.status?n.push(e("Button",{props:{type:"primary",size:"small"},class:"ml-5",on:{click:function(e){return t.showDetail(a.row,1)}}},"盘点录入")):190==a.row.status&&n.push(e("Button",{props:{type:"primary",size:"small"},class:"ml-5",on:{click:function(e){return t.closeBill({countBill:{countBillNo:a.row.countBillNo}})}}},"盘点单关闭")),e("div",n)}}],detailtype:0,detailInfo:{createTime:"",creatorName:"",status:"",countBillNo:""},detailOriginData:{},detailLoading:!1,detailVisible:!1,detailGoodsCoulmns:[{title:"序号",width:75,align:"center",render:function(t,e){return t("span",e.index+1)}},{title:"商品行编号",align:"center",width:114,key:"countEntryNo"},{title:"商品名称",align:"center",width:200,key:"materialName79"},{title:"条形码",align:"center",width:124,key:"materialCode69"},{title:"物料编码",align:"center",width:160,key:"code80",render:function(t,e){var a=e.row.code80;if(!a)return t("span","-");if("-"===a)return t("span","-");var n=[];return a.split(",").forEach(function(e){n.push(t("div",{class:"code80-tag"},e)),n.push(t("br"))}),t("div",{attrs:{style:"margin:5px 0;"}},n)}},{title:"实盘整件数",align:"center",key:"inputByCar",render:function(e,a){return t.detailtype?e("Input",{props:{value:a.row.inputByCar},class:{"input-enter-trans":!0,"input-warning":a.row.warning},on:{"on-blur":function(e){return t.checkInput(a,e)},"on-enter":function(e){return t.handleInputEnter(e)}}}):e("span",a.row.inputByCar)}},{title:"实盘散个数",align:"center",key:"inputByEa",render:function(e,a){return t.detailtype?e("Input",{props:{value:a.row.inputByEa},class:{"input-enter-trans":!0,"input-warning":a.row.warning},on:{"on-blur":function(e){return t.checkInput(a,e)},"on-enter":function(e){return t.handleInputEnter(e)}}}):e("span",a.row.inputByEa)}},{title:"盘点前整件数",align:"center",key:"countBeforeCarNum"},{title:"盘点前散个数",align:"center",key:"countBeforeEaNum"},{title:"当前合计整件数",align:"center",key:"totalBoxNum"},{title:"当前合计散个数",align:"center",key:"totalSingleNum"}],detailGoodsData:[]}},mounted:function(){this.queryData()},methods:{billStatusText:function(t){switch(parseInt(t)){case 0:return"待盘点";case 100:return"盘点结果已录入";case 190:return"盘点失败";case 200:return"盘点结束";default:return t}},queryData:function(){function t(){return e.apply(this,arguments)}var e=(0,p.default)(l.default.mark(function t(){var e,a,n,r,i,o;return l.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=(0,u.default)({},this.query),a="",this.loading=!0,this.tableData=[],t.prev=4,t.next=7,this.$ajax.post(this.apiGroup.list,v.stringify(e));case 7:n=t.sent,r=n.data,200==r.code?(i=r.result.data,o=r.result.pager.totalCount,this.total=o,i instanceof Array&&(this.tableData=i)):a="盘点单列表获取失败",t.next=16;break;case 12:t.prev=12,t.t0=t.catch(4),console.error(t.t0),a="盘点单列表获取失败";case 16:this.loading=!1,a&&this.$Message.error(a);case 18:case"end":return t.stop()}},t,this,[[4,12]])}));return t}(),handleQueryBtnClick:function(){this.query.page=1,this.queryData()},handleResetBtnClick:function(){this.query={countBillNo:"",status:"",page:1,row:10},this.queryData()},showDetail:function(){function t(t,a){return e.apply(this,arguments)}var e=(0,p.default)(l.default.mark(function t(e,a){var n,r,i,o,s,c,p=e.countBillNo;return l.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.detailVisible=!0,this.detailtype=a,this.detailGoodsData=[],this.detailLoading=!0,n="",t.prev=5,t.next=8,this.$ajax.post(this.apiGroup.detail,{countBillNo:p});case 8:r=t.sent,i=r.data,200==i.code?(o=i.result.countBill,this.detailOriginData={countBill:o},this.detailInfo={countBillNo:o.countBillNo,statusText:this.billStatusText(o.status),status:o.status,creatorName:o.creatorName,createTime:o.createTime>0?(0,d.formatDate)(new Date(1e3*o.createTime),"yyyy-MM-DD"):""},s=void 0,localStorage.countBillEditCache&&(c=JSON.parse(localStorage.countBillEditCache),c[p]&&(s=c[p])),this.detailGoodsData=i.result.countBillDetailVoList.map(function(t){var e=t.countBeforeCarNum,a=t.countBeforeEaNum,n=void 0;t.inputByCar&&null!==t.inputByCar&&(e=t.inputByCar),t.inputByEa&&null!==t.inputByEa&&(a=t.inputByEa),s&&s[t.countEntryNo]&&(n=s[t.countEntryNo]),n&&(a=parseInt(n.eaEdit),e=parseInt(n.carEdit));var r=!1;return e*t.transformRule+parseFloat(a)!==t.countBeforeCarNum*t.transformRule+parseFloat(t.countBeforeEaNum)&&(r=!0),(0,u.default)({},t,{inputByEa:a,inputByCar:e,warning:r})})):n="盘点单详情获取失败",t.next=17;break;case 13:t.prev=13,t.t0=t.catch(5),console.error(t.t0),n="盘点单详情获取失败";case 17:this.detailLoading=!1,n&&this.$Message.error(n);case 19:case"end":return t.stop()}},t,this,[[5,13]])}));return t}(),checkInput:function(t,e){var a=t.column.key,n=parseInt(e.target.value),r=t.row;if((isNaN(n)||n<0)&&(n="inputByCar"==a?r.countBeforeCarNum:r.countBeforeEaNum),isNaN(n)||n<0)return setTimeout(_=e.target.value=r[a]);e.target.value.length!=n.toString().length&&setTimeout(function(t){return e.target.value=n}),r[a]=n;var i=r.inputByCar*r.transformRule+parseFloat(r.inputByEa),o=r.countBeforeCarNum*r.transformRule+parseFloat(r.countBeforeEaNum);r.warning=i!==o,this.detailGoodsData[t.index]=r},closeBill:function(t,e,a){var n=this;this.$Modal.confirm({title:"关闭盘点单",content:"确认关闭盘点单",onOk:function(){function r(t){return i.apply(this,arguments)}var i=(0,p.default)(l.default.mark(function r(i){var o,s,u,c;return l.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return o="",s="",r.prev=2,r.next=5,n.$ajax.post(n.apiGroup.close,t);case 5:u=r.sent,c=u.data,200==c.code?(c.message&&(s=c.message),setTimeout(function(t){n.$Modal.success({content:s,onOk:function(t){n.queryData(),e&&e()}})},500)):(o="盘点单关闭失败",c.message&&(o=c.message)),r.next=13;break;case 10:r.prev=10,r.t0=r.catch(2),o="关闭请求发送失败";case 13:o&&(setTimeout(function(t){return n.$Modal.error({content:o})},500),a&&a());case 14:case"end":return r.stop()}},r,n,[[2,10]])}));return r}(),onCancel:function(t){}})},handleInputEnter:function(t){var e=document.querySelectorAll(".input-enter-trans");e.forEach(function(a,n){if(t.target==a.querySelector("input")){if(n>=e.length-1)return;t.target.blur(),setTimeout(function(t){document.querySelectorAll(".input-enter-trans")[n+1].querySelector("input").focus()})}})},handleCloseBillBtnClick:function(){var t=this;this.closeBill(this.detailOriginData,function(e){t.detailVisible=!1})},handleSaveBillBtnClick:function(){var t={};localStorage.countBillEditCache&&(t=JSON.parse(localStorage.countBillEditCache));var e=this.detailInfo.countBillNo,a={};this.detailGoodsData.forEach(function(t){a[t.countEntryNo]={carEdit:t.inputByCar,eaEdit:t.inputByEa}}),t[e]=a,localStorage.countBillEditCache=(0,i.default)(t),this.$Message.success("本地浏览器暂存成功")},handleSubmintBillBtnClick:function(){function t(){return e.apply(this,arguments)}var e=(0,p.default)(l.default.mark(function t(){var e,a,n,r,i,o=this;return l.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=(0,u.default)({},this.detailOriginData),e.countBillDetailVoList=this.detailGoodsData.concat(),a="",t.prev=3,t.next=6,this.$ajax.post(this.apiGroup.confirm,e);case 6:n=t.sent,r=n.data,i=r.message,200==r.code?this.$Modal.success({content:r.message,onOk:function(t){o.detailVisible=!1,o.queryData()}}):a=r.message,t.next=16;break;case 12:t.prev=12,t.t0=t.catch(3),console.error(t.t0),a="提交请求发送失败";case 16:a&&this.$Modal.error({content:a});case 17:case"end":return t.stop()}},t,this,[[3,12]])}));return t}()}}},2392:function(t,e,a){var n=a(2393);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);a(43)("1b708666",n,!1,{})},2393:function(t,e,a){e=t.exports=a(42)(!1),e.push([t.i,"\n.query-btn[data-v-6c645c0f] {\n  margin-left: 80px;\n  margin-right: 20px;\n}\n.custom-hr[data-v-6c645c0f] {\n  margin-top: 15px;\n}\n.custom-page[data-v-6c645c0f] {\n  margin-top: 15px;\n  float: right;\n}\n.custom-h3[data-v-6c645c0f] {\n  margin: 15px 0;\n}\n.custom-h3[data-v-6c645c0f]:first-of-type {\n  margin-top: 0;\n}\n",""])},2394:function(t,e,a){var n=a(2395);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);a(43)("a1677de6",n,!1,{})},2395:function(t,e,a){e=t.exports=a(42)(!1),e.push([t.i,"\n.Table-detailGoods .ivu-table-body {\n  min-height: 58px;\n  max-height: 200px;\n  overflow-y: auto;\n  overflow-x: hidden;\n}\n#count-bill-manage-list .ml-5 {\n  margin-left: 5px;\n}\n.input-warning input {\n  color: red;\n  border-color: red;\n}\n.code80-tag {\n  margin: 2px 0;\n  border: 1px solid #aaa;\n  border-radius: 4px;\n  line-height: 14px;\n  width: auto;\n  display: inline-block;\n  padding: 2px 4px;\n  color: #666;\n}\n",""])},2396:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Card",{attrs:{id:"count-bill-manage-list"}},[a("Form",{attrs:{"label-width":90}},[a("Row",[a("Col",{attrs:{span:"6"}},[a("FormItem",{attrs:{label:"盘点单号"}},[a("Input",{attrs:{clearable:""},model:{value:t.query.countBillNo,callback:function(e){t.$set(t.query,"countBillNo",e)},expression:"query.countBillNo"}})],1)],1),t._v(" "),a("Col",{attrs:{span:"6"}},[a("FormItem",{attrs:{label:"盘点单状态"}},[a("Select",{model:{value:t.query.status,callback:function(e){t.$set(t.query,"status",e)},expression:"query.status"}},[a("Option",{attrs:{value:""}},[t._v("全部")]),t._v(" "),a("Option",{attrs:{value:0}},[t._v("待盘点")]),t._v(" "),a("Option",{attrs:{value:100}},[t._v("盘点结果已录入")]),t._v(" "),a("Option",{attrs:{value:200}},[t._v("盘点结束")])],1)],1)],1)],1),t._v(" "),a("Row",[a("Button",{staticClass:"query-btn",attrs:{type:"primary"},on:{click:t.handleQueryBtnClick}},[t._v("查询")]),t._v(" "),a("Button",{attrs:{type:"primary"},on:{click:t.handleResetBtnClick}},[t._v("重置")])],1)],1),t._v(" "),a("DefaultHr",{staticClass:"custom-hr"}),t._v(" "),a("div",[a("Table",{attrs:{data:t.tableData,columns:t.tableColumns,loading:t.loading}})],1),t._v(" "),a("Row",[a("Page",{staticClass:"custom-page",attrs:{"page-size":t.query.row,current:t.query.page,total:t.total,"show-elevator":"","show-total":""},on:{"update:current":function(e){t.$set(t.query,"page",e)},"on-change":t.queryData}})],1),t._v(" "),a("Modal",{attrs:{title:t.detailtype?"盘点单录入":"盘点查看",width:1200},model:{value:t.detailVisible,callback:function(e){t.detailVisible=e},expression:"detailVisible"}},[a("Spin",{directives:[{name:"show",rawName:"v-show",value:t.detailLoading,expression:"detailLoading"}],staticStyle:{"border-radius":"5px"},attrs:{fix:""}}),t._v(" "),a("h3",{staticClass:"custom-h3"},[t._v("基本信息")]),t._v(" "),a("Row",{staticClass:"custom-row",attrs:{gutter:16}},[a("Col",{attrs:{span:"6"}},[a("span",[t._v("盘点单号: ")]),t._v(" "),a("span",[t._v(t._s(t.detailInfo.countBillNo))])]),t._v(" "),a("Col",{attrs:{span:"6"}},[a("span",[t._v("盘点单状态: ")]),t._v(" "),a("span",[t._v(t._s(t.detailInfo.statusText))])]),t._v(" "),a("Col",{attrs:{span:"6"}},[a("span",[t._v("盘点人: ")]),t._v(" "),a("span",[t._v(t._s(t.detailInfo.creatorName))])]),t._v(" "),a("Col",{attrs:{span:"6"}},[a("span",[t._v("盘点日期: ")]),t._v(" "),a("span",[t._v(t._s(t.detailInfo.createTime))])])],1),t._v(" "),a("h3",{staticClass:"custom-h3"},[t._v("商品信息")]),t._v(" "),a("Table",{staticClass:"Table-detailGoods",attrs:{columns:t.detailGoodsCoulmns,data:t.detailGoodsData}}),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{directives:[{name:"show",rawName:"v-show",value:t.detailtype,expression:"detailtype"}],attrs:{type:"primary"},on:{click:t.handleCloseBillBtnClick}},[t._v("关闭盘点单")]),t._v(" "),a("Button",{directives:[{name:"show",rawName:"v-show",value:t.detailtype,expression:"detailtype"}],attrs:{type:"primary"},on:{click:t.handleSaveBillBtnClick}},[t._v("暂存")]),t._v(" "),a("Button",{directives:[{name:"show",rawName:"v-show",value:t.detailtype,expression:"detailtype"}],attrs:{type:"primary"},on:{click:t.handleSubmintBillBtnClick}},[t._v("提交盘点")]),t._v(" "),a("Button",{on:{click:function(e){t.detailVisible=!1}}},[t._v("关闭")])],1)],1)],1)},r=[];n._withStripped=!0;var i={render:n,staticRenderFns:r};e.default=i},603:function(t,e,a){"use strict";function n(t){u||a(964)}Object.defineProperty(e,"__esModule",{value:!0});var r=a(939),i=a.n(r);for(var o in r)"default"!==o&&function(t){a.d(e,t,function(){return r[t]})}(o);var l=a(966),s=a.n(l),u=!1,c=a(13),p=n,d=c(i.a,s.a,!1,p,"data-v-eb39e066",null);d.options.__file="src/views/my-components/default-hr/default-hr.vue",e.default=d.exports},819:function(t,e,a){"use strict";function n(t){u||(a(2392),a(2394))}Object.defineProperty(e,"__esModule",{value:!0});var r=a(1704),i=a.n(r);for(var o in r)"default"!==o&&function(t){a.d(e,t,function(){return r[t]})}(o);var l=a(2396),s=a.n(l),u=!1,c=a(13),p=n,d=c(i.a,s.a,!1,p,"data-v-6c645c0f",null);d.options.__file="src/views/stock-manage/count-bill-manager/list.vue",e.default=d.exports},898:function(t,e,a){"use strict";function n(t,e){if(!e)var e="yyyy-MM-DD hh:mm:ss";var a={"M+":t.getMonth()+1,"D+":t.getDate(),"h+":t.getHours(),"m+":t.getMinutes(),"s+":t.getSeconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(t.getFullYear()+"").substr(4-RegExp.$1.length)));for(var n in a)new RegExp("("+n+")").test(e)&&(e=e.replace(RegExp.$1,1===RegExp.$1.length?a[n]:("00"+a[n]).substr((""+a[n]).length)));return e}function r(t,e){if(!e)var e="yyyy-MM-dd";(t=Number(t))<1e10&&(t*=1e3);var a=new Date(t),n={"M+":a.getMonth()+1,"d+":a.getDate(),"h+":a.getHours(),"m+":a.getMinutes(),"s+":a.getSeconds(),"q+":Math.floor((a.getMonth()+3)/3),S:a.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(a.getFullYear()+"").substr(4-RegExp.$1.length)));for(var r in n)new RegExp("("+r+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?n[r]:("00"+n[r]).substr((""+n[r]).length)));return e}Object.defineProperty(e,"__esModule",{value:!0}),e.formatDate=n,e.timestampToDay=r},939:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={}},964:function(t,e,a){var n=a(965);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);a(43)("63be8b28",n,!1,{})},965:function(t,e,a){e=t.exports=a(42)(!1),e.push([t.i,"\n.default-hr[data-v-eb39e066] {\n  width: 100%;\n  height: 1px;\n  border: none;\n  border-top: 1px dashed #aaa;\n  margin-bottom: 20px;\n}\n",""])},966:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){var t=this,e=t.$createElement;return(t._self._c||e)("hr",{staticClass:"default-hr"})},r=[];n._withStripped=!0;var i={render:n,staticRenderFns:r};e.default=i}});